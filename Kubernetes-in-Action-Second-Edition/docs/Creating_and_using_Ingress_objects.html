
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>12.2 Creating and using Ingress objects · Kubernetes实战（第二版）</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="wangwei17">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-page-toc-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-hints/plugin-hints.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="Configuring_TLS_for_an_Ingress.html" />
    
    
    <link rel="prev" href="Introducing_Ingresses.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://wangwei1237.gitee.io/" target="_blank" class="custom-link">17哥的个人网站</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    前言
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Welcome</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="Welcome.html">
            
                <a href="Welcome.html">
            
                    
                    Welcome
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Part 1: First Time On a Boat: Introduction to Kubernetes</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="Introducing_Kubernetes_0.html">
            
                <a href="Introducing_Kubernetes_0.html">
            
                    
                    1 Introducing Kubernetes
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="Introducing_Kubernetes_1.html">
            
                <a href="Introducing_Kubernetes_1.html">
            
                    
                    1.1 Introducing Kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="Understanding_Kubernetes.html">
            
                <a href="Understanding_Kubernetes.html">
            
                    
                    1.2 Understanding Kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="Introducing_Kubernetes_into_your_organization.html">
            
                <a href="Introducing_Kubernetes_into_your_organization.html">
            
                    
                    1.3 Introducing Kubernetes into your organization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4" data-path="Summary_1.html">
            
                <a href="Summary_1.html">
            
                    
                    1.4 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="Understanding_containers.html">
            
                <a href="Understanding_containers.html">
            
                    
                    2 Understanding containers
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1" data-path="Introducing_containers.html">
            
                <a href="Introducing_containers.html">
            
                    
                    2.1 Introducing containers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.2" data-path="Exploring_containers_hands-on.html">
            
                <a href="Exploring_containers_hands-on.html">
            
                    
                    2.2 Exploring containers hands-on
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.3" data-path="Understanding_what_makes_containers_possible.html">
            
                <a href="Understanding_what_makes_containers_possible.html">
            
                    
                    2.3 Understanding what makes containers possible
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.4" data-path="Summary_2.html">
            
                <a href="Summary_2.html">
            
                    
                    2.4 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="Deploying_your_first_application.html">
            
                <a href="Deploying_your_first_application.html">
            
                    
                    3 DEPLOYING YOUR FIRST APPLICATION
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.3.1" data-path="Deploying_a_Kubernetes_cluster.html">
            
                <a href="Deploying_a_Kubernetes_cluster.html">
            
                    
                    3.1 Deploying a Kubernetes cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.2" data-path="Interacting_with_Kubernetes.html">
            
                <a href="Interacting_with_Kubernetes.html">
            
                    
                    3.2 Interacting with Kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.3" data-path="Running_your_first_application_on_Kubernetes.html">
            
                <a href="Running_your_first_application_on_Kubernetes.html">
            
                    
                    3.3  Running your first application on Kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.4" data-path="Summary_3.html">
            
                <a href="Summary_3.html">
            
                    
                    3.4 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Part 2: Learning the Ropes: Kubernetes API Objects</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="Introducing_the_Kubernetes_API_Objects.html">
            
                <a href="Introducing_the_Kubernetes_API_Objects.html">
            
                    
                    4. Introducing the Kubernetes API Objects
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="Getting_familiar_with_the_Kubernetes_API.html">
            
                <a href="Getting_familiar_with_the_Kubernetes_API.html">
            
                    
                    4.1 Getting familiar with the Kubernetes API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2" data-path="Examining_an_objects_individual_properties.html">
            
                <a href="Examining_an_objects_individual_properties.html">
            
                    
                    4.2 Examining an object’s individual properties
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3" data-path="Observing_cluster_events_via_Event_objects.html">
            
                <a href="Observing_cluster_events_via_Event_objects.html">
            
                    
                    4.3 Observing cluster events via Event objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.4" data-path="Summary_4.html">
            
                <a href="Summary_4.html">
            
                    
                    4.4 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="Running_applications_in_Pods.html">
            
                <a href="Running_applications_in_Pods.html">
            
                    
                    5. Running applications in Pods
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.1" data-path="Understanding_pods.html">
            
                <a href="Understanding_pods.html">
            
                    
                    5.1  Understanding pods
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.2" data-path="Creating_pods_from_YAML_or_JSON_files.html">
            
                <a href="Creating_pods_from_YAML_or_JSON_files.html">
            
                    
                    5.2 Creating pods from YAML or JSON files
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.3" data-path="Interacting_with_the_application_and_the_pod.html">
            
                <a href="Interacting_with_the_application_and_the_pod.html">
            
                    
                    5.3 Interacting with the application and the pod
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.4" data-path="Running_multiple_containers_in_a_pod.html">
            
                <a href="Running_multiple_containers_in_a_pod.html">
            
                    
                    5.4 Running multiple containers in a pod
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.5" data-path="Running_additional_containers_at_pod_startup.html">
            
                <a href="Running_additional_containers_at_pod_startup.html">
            
                    
                    5.5 Running additional containers at pod startup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.6" data-path="Deleting_pods_and_other_objects.html">
            
                <a href="Deleting_pods_and_other_objects.html">
            
                    
                    5.6 Deleting pods and other objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.7" data-path="Summary_5.html">
            
                <a href="Summary_5.html">
            
                    
                    5.7 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="Managing_the_lifecycle_of_the_Pods_containers.html">
            
                <a href="Managing_the_lifecycle_of_the_Pods_containers.html">
            
                    
                    6. Managing the lifecycle of the Pod’s containers
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.3.1" data-path="Understanding_the_pods_status.html">
            
                <a href="Understanding_the_pods_status.html">
            
                    
                    6.1 Understanding the pod's status
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.2" data-path="Keeping_containers_healthy.html">
            
                <a href="Keeping_containers_healthy.html">
            
                    
                    6.2 Keeping containers healthy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.3" data-path="Executing_actions_at_container_startup_and_shutdown.html">
            
                <a href="Executing_actions_at_container_startup_and_shutdown.html">
            
                    
                    6.3 Executing actions at container start-up and shutdown
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.4" data-path="Understanding_the_pod_lifecycle.html">
            
                <a href="Understanding_the_pod_lifecycle.html">
            
                    
                    6.4 Understanding the pod lifecycle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.5" data-path="Summary_6.html">
            
                <a href="Summary_6.html">
            
                    
                    6.5 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="Mounting_storage_volumes_into_the_Pods_containers.html">
            
                <a href="Mounting_storage_volumes_into_the_Pods_containers.html">
            
                    
                    7. Mounting storage volumes into the Pod’s containers
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.4.1" data-path="Introducing_volumes.html">
            
                <a href="Introducing_volumes.html">
            
                    
                    7.1 Introducing volumes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.2" data-path="Using_volumes.html">
            
                <a href="Using_volumes.html">
            
                    
                    7.2 Using volumes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.3" data-path="Integrating_external_storage_into_pods.html">
            
                <a href="Integrating_external_storage_into_pods.html">
            
                    
                    7.3 Integrating external storage into pods
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.4" data-path="Accessing_files_on_the_worker_nodes_filesystem.html">
            
                <a href="Accessing_files_on_the_worker_nodes_filesystem.html">
            
                    
                    7.4 Accessing files on the worker node’s filesystem
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.5" data-path="Summary_7.html">
            
                <a href="Summary_7.html">
            
                    
                    7.5 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="Persisting_application_data_with_PersistentVolumes.html">
            
                <a href="Persisting_application_data_with_PersistentVolumes.html">
            
                    
                    8. Persisting application data with PersistentVolumes
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.5.1" data-path="Decoupling_pods_from_the_underlying_storage_technology.html">
            
                <a href="Decoupling_pods_from_the_underlying_storage_technology.html">
            
                    
                    8.1 Decoupling pods from the underlying storage technology
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5.2" data-path="Creating_persistent_volumes_and_claims.html">
            
                <a href="Creating_persistent_volumes_and_claims.html">
            
                    
                    8.2 Creating persistent volumes and claims
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5.3" data-path="Dynamic_provisioning_of_persistent_volumes.html">
            
                <a href="Dynamic_provisioning_of_persistent_volumes.html">
            
                    
                    8.3 Dynamic provisioning of persistent volumes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5.4" data-path="Nodelocal_persistent_volumes.html">
            
                <a href="Nodelocal_persistent_volumes.html">
            
                    
                    8.4 Node-local persistent volumes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5.5" data-path="Summary_8.html">
            
                <a href="Summary_8.html">
            
                    
                    8.5 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="Configuring_applications_using_ConfigMaps_Secrets_and_the_Downward_API.html">
            
                <a href="Configuring_applications_using_ConfigMaps_Secrets_and_the_Downward_API.html">
            
                    
                    9. Configuring applications using ConfigMaps, Secrets, and the Downward API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.6.1" data-path="Setting_the_command_arguments_and_environment_variables.html">
            
                <a href="Setting_the_command_arguments_and_environment_variables.html">
            
                    
                    9.1 Setting the command, arguments, and environment variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6.2" data-path="Using_a_config_map_to_decouple_configuration_from_the_pod.html">
            
                <a href="Using_a_config_map_to_decouple_configuration_from_the_pod.html">
            
                    
                    9.2 Using a config map to decouple configuration from the pod
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6.3" data-path="Using_Secrets_to_pass_sensitive_data_to_containers.html">
            
                <a href="Using_Secrets_to_pass_sensitive_data_to_containers.html">
            
                    
                    9.3 Using Secrets to pass sensitive data to containers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6.4" data-path="Passing_pod_metadata_to_the_application_via_the_Downward_API.html">
            
                <a href="Passing_pod_metadata_to_the_application_via_the_Downward_API.html">
            
                    
                    9.4 Passing pod metadata to the application via the Downward API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6.5" data-path="Using_projected_volumes_to_combine_volumes_into_one.html">
            
                <a href="Using_projected_volumes_to_combine_volumes_into_one.html">
            
                    
                    9.5 Using projected volumes to combine volumes into one
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6.6" data-path="Summary_9.html">
            
                <a href="Summary_9.html">
            
                    
                    9.6 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="Organizing_objects_using_Namespaces_labels.html">
            
                <a href="Organizing_objects_using_Namespaces_labels.html">
            
                    
                    10. Organizing objects using Namespaces, labels, and selectors
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.7.1" data-path="Organizing_objects_into_Namespaces.html">
            
                <a href="Organizing_objects_into_Namespaces.html">
            
                    
                    10.1 Organizing objects into Namespaces
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.7.2" data-path="Organizing_pods_with_labels.html">
            
                <a href="Organizing_pods_with_labels.html">
            
                    
                    10.2 Organizing pods with labels
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.7.3" data-path="Filtering_Objects_With_Label_Selectors.html">
            
                <a href="Filtering_Objects_With_Label_Selectors.html">
            
                    
                    10.3 Filtering objects with label selectors.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.7.4" data-path="Annotating_objects.html">
            
                <a href="Annotating_objects.html">
            
                    
                    10.4 Annotating objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.7.5" data-path="Summary_10.html">
            
                <a href="Summary_10.html">
            
                    
                    10.5 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.8" data-path="Exposing_Pods_with_Services.html">
            
                <a href="Exposing_Pods_with_Services.html">
            
                    
                    11. Exposing Pods with Services
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.8.1" data-path="Exposing_pods_via_services.html">
            
                <a href="Exposing_pods_via_services.html">
            
                    
                    11.1 Exposing pods via services
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.8.2" data-path="Exposing_services_externally.html">
            
                <a href="Exposing_services_externally.html">
            
                    
                    11.2 Exposing services externally
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.8.3" data-path="Managing_service_endpoints.html">
            
                <a href="Managing_service_endpoints.html">
            
                    
                    11.3 Managing service endpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.8.4" data-path="Understanding_DNS_records_for_Service_objects.html">
            
                <a href="Understanding_DNS_records_for_Service_objects.html">
            
                    
                    11.4 Understanding DNS records for Service objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.8.5" data-path="Configuring_services_to_route_traffic_to_nearby_endpoints.html">
            
                <a href="Configuring_services_to_route_traffic_to_nearby_endpoints.html">
            
                    
                    11.5 Configuring services to route traffic to nearby endpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.8.6" data-path="Managing_the_inclusion_of_a_pod_in_service_endpoints.html">
            
                <a href="Managing_the_inclusion_of_a_pod_in_service_endpoints.html">
            
                    
                    11.6 Managing the inclusion of a pod in service endpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.8.7" data-path="Summary_11.html">
            
                <a href="Summary_11.html">
            
                    
                    11.7 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.9" data-path="Exposing_Services_with_Ingress.html">
            
                <a href="Exposing_Services_with_Ingress.html">
            
                    
                    12. Exposing Services with Ingress
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.9.1" data-path="Introducing_Ingresses.html">
            
                <a href="Introducing_Ingresses.html">
            
                    
                    12.1 Introducing Ingresses
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="4.9.2" data-path="Creating_and_using_Ingress_objects.html">
            
                <a href="Creating_and_using_Ingress_objects.html">
            
                    
                    12.2 Creating and using Ingress objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.9.3" data-path="Configuring_TLS_for_an_Ingress.html">
            
                <a href="Configuring_TLS_for_an_Ingress.html">
            
                    
                    12.3 Configuring TLS for an Ingress
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.9.4" data-path="Additional_Ingress_configuration_options.html">
            
                <a href="Additional_Ingress_configuration_options.html">
            
                    
                    12.4 Additional Ingress configuration options
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.9.5" data-path="Using_multiple_ingress_controllers.html">
            
                <a href="Using_multiple_ingress_controllers.html">
            
                    
                    12.5 Using multiple ingress controllers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.9.6" data-path="Using_custom_resources_instead_of_services_as_backends.html">
            
                <a href="Using_custom_resources_instead_of_services_as_backends.html">
            
                    
                    12.6 Using custom resources instead of services as backends
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.9.7" data-path="Summary_12.html">
            
                <a href="Summary_12.html">
            
                    
                    12.7 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.10" data-path="Replicating_Pods_with_ReplicaSets.html">
            
                <a href="Replicating_Pods_with_ReplicaSets.html">
            
                    
                    13 Replicating Pods with ReplicaSets
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.10.1" data-path="Introducing_ReplicaSets.html">
            
                <a href="Introducing_ReplicaSets.html">
            
                    
                    13.1 Introducing ReplicaSets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.10.2" data-path="Updating_a_ReplicaSet.html">
            
                <a href="Updating_a_ReplicaSet.html">
            
                    
                    13.2 Updating a ReplicaSet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.10.3" data-path="Understanding_the_operation_of_the_ReplicaSet_controller.html">
            
                <a href="Understanding_the_operation_of_the_ReplicaSet_controller.html">
            
                    
                    13.3 Understanding the operation of the ReplicaSet controller
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.10.4" data-path="Deleting_a_ReplicaSet.html">
            
                <a href="Deleting_a_ReplicaSet.html">
            
                    
                    13.4 Deleting a ReplicaSet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.10.5" data-path="Summary_13.html">
            
                <a href="Summary_13.html">
            
                    
                    13.5 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.11" data-path="Managing_Pods_with_Deployments.html">
            
                <a href="Managing_Pods_with_Deployments.html">
            
                    
                    14 Managing Pods with Deployments
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.11.1" data-path="Introducing_Deployments.html">
            
                <a href="Introducing_Deployments.html">
            
                    
                    14.1 Introducing Deployments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.11.2" data-path="Updating_a_Deployment.html">
            
                <a href="Updating_a_Deployment.html">
            
                    
                    14.2 Updating a Deployment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.11.3" data-path="Implementing_other_deployment_strategies.html">
            
                <a href="Implementing_other_deployment_strategies.html">
            
                    
                    14.3 Implementing other deployment strategies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.11.4" data-path="Summary_14.html">
            
                <a href="Summary_14.html">
            
                    
                    14.4 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.12" data-path="Deploying_stateful_workloads_with_StatefulSets.html">
            
                <a href="Deploying_stateful_workloads_with_StatefulSets.html">
            
                    
                    15 Deploying stateful workloads with StatefulSets
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.12.1" data-path="Introducing_StatefulSets.html">
            
                <a href="Introducing_StatefulSets.html">
            
                    
                    15.1 IntroducingStatefulSets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.12.2" data-path="Understanding_StatefulSet_behavior.html">
            
                <a href="Understanding_StatefulSet_behavior.html">
            
                    
                    15.2 Understanding StatefulSet behavior
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.12.3" data-path="Updating_a_StatefulSet.html">
            
                <a href="Updating_a_StatefulSet.html">
            
                    
                    15.3 Updating a StatefulSet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.12.4" data-path="Managing_stateful_applications_with_Kubernetes_Operators.html">
            
                <a href="Managing_stateful_applications_with_Kubernetes_Operators.html">
            
                    
                    15.4 Managing stateful applications with Kubernetes Operators
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.12.5" data-path="Summary_15.html">
            
                <a href="Summary_15.html">
            
                    
                    15.5 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.13" data-path="Deploying_node_agents_and_daemons_with_DaemonSets.html">
            
                <a href="Deploying_node_agents_and_daemons_with_DaemonSets.html">
            
                    
                    16 Deploying node agents and daemons with DaemonSets
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.13.1" data-path="Introducing_DaemonSets.html">
            
                <a href="Introducing_DaemonSets.html">
            
                    
                    16.1 Introducing DaemonSets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.13.2" data-path="Special_features_in_Pods_running_node_agents_and_daemons.html">
            
                <a href="Special_features_in_Pods_running_node_agents_and_daemons.html">
            
                    
                    16.2 Special features in Pods running node agents and daemons
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.13.3" data-path="Communicating_with_the_local_daemon_Pod.html">
            
                <a href="Communicating_with_the_local_daemon_Pod.html">
            
                    
                    16.3  Communicating with the local daemon Pod
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.13.4" data-path="Summary_16.html">
            
                <a href="Summary_16.html">
            
                    
                    16.4 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.14" data-path="Running_finite_workloads_with_Jobs_and_CronJobss.html">
            
                <a href="Running_finite_workloads_with_Jobs_and_CronJobss.html">
            
                    
                    17 Running finite workloads with Jobs and CronJobs
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.14.1" data-path="Running_tasks_with_the_Job_resource.html">
            
                <a href="Running_tasks_with_the_Job_resource.html">
            
                    
                    17.1 Running tasks with the Job resource
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.14.2" data-path="Scheduling_Jobs_with_CronJobs.html">
            
                <a href="Scheduling_Jobs_with_CronJobs.html">
            
                    
                    17.2 Scheduling Jobs with CronJobs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.14.3" data-path="Summary_17.html">
            
                <a href="Summary_17.html">
            
                    
                    17.3 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >12.2 Creating and using Ingress objects</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="122-creating-and-using-ingress-objects">12.2 Creating and using Ingress objects</h1>
<p>The previous section explained the basics of Ingress objects and controllers, and how to install the Nginx ingress controller. In this section, you&#x2019;ll learn how to use an Ingress to expose the services of the Kiada suite.</p>
<p>Before you create your first Ingress object, you must deploy the pods and services of the Kiada suite. If you followed the exercises in the previous chapter, they should already be there. If not, you can create them by creating the <code>kiada</code> namespace and then applying all manifests in the the <code>Chapter12/SETUP/</code> directory with the following command:</p>
<pre><code class="lang-shell">$ kubectl apply -f SETUP/ --recursive
</code></pre>
<h2 id="1221-exposing-a-service-through-an-ingress">12.2.1 Exposing a service through an Ingress</h2>
<p>An Ingress object references one or more Service objects. Your first Ingress object exposes the <code>kiada</code> service, which you created in the previous chapter. Before you create the Ingress, refresh your memory by looking at the service manifest in the following listing.</p>
<p>Listing 12.1 The kiada service manifest</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Service
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> kiada
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  type:</span> ClusterIP
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    app:</span> kiada
<span class="hljs-attr">  ports:</span>
<span class="hljs-attr">  - name:</span> http
<span class="hljs-attr">    port:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">    targetPort:</span> <span class="hljs-number">8080</span>
<span class="hljs-attr">  - name:</span> https
<span class="hljs-attr">    port:</span> <span class="hljs-number">443</span>
<span class="hljs-attr">    targetPort:</span> <span class="hljs-number">8443</span>
</code></pre>
<p>The Service type is <code>ClusterIP</code> because the service itself doesn&#x2019;t need to be directly accessible to clients outside the cluster, since the Ingress will take care of that. Although the service exposes ports <code>80</code> and <code>443</code>, the Ingress will forward traffic only to port 80.</p>
<h4 id="creating-the-ingress-object">Creating the Ingress object</h4>
<p>The Ingress object manifest is shown in the following listing. You can find it in the file <code>Chapter12/ing.kiada-example-com.yaml</code> in the book&#x2019;s code repository.</p>
<p>Listing 12.2 An Ingress object exposing the kiada service at kiada.example.com</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> networking.k8s.io/v1
<span class="hljs-attr">kind:</span> Ingress
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> kiada-example-com
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  rules:</span>
<span class="hljs-attr">  - host:</span> kiada.example.com
<span class="hljs-attr">    http:</span>
<span class="hljs-attr">      paths:</span>
<span class="hljs-attr">      - path:</span> /
<span class="hljs-attr">        pathType:</span> Prefix
<span class="hljs-attr">        backend:</span>
<span class="hljs-attr">          service:</span>
<span class="hljs-attr">            name:</span> kiada
<span class="hljs-attr">            port:</span>
<span class="hljs-attr">              number:</span> <span class="hljs-number">80</span>
</code></pre>
<p>The manifest in the listing defines an Ingress object named <code>kiada-example-com</code>. While you can give the object any name you want, it&#x2019;s recommended that the name reflect the host and/or path(s) specified in the ingress rules.</p>
<p><div class="alert alert-info hints-alert"><div class="hints-icon"><i class="fa fa-info-circle"></i></div><div class="hints-container"><p>WARNING</p>
<p>In Google Kubernetes Engine, the Ingress name mustn&#x2019;t contain dots, otherwise the following error message will be displayed in the events associated with the Ingress object: <code>Error syncing to GCP: error running load balancer syncing routine: invalid loadbalancer name</code>.</p>
</div></div></p>
<p>The Ingress object in the listing defines a single rule. The rule states that all requests for the host <code>kiada.example.com</code> should be forwarded to port <code>80</code> of the <code>kiada</code> service, regardless of the requested path (as indicated by the <code>path</code> and <code>pathType</code> fields). This is illustrated in the following figure.</p>
<p>Figure 12.4 How the kiada-example-com Ingress object configures external traffic routing</p>
<p><img src="../images/12.4.png" alt=""></p>
<h4 id="inspecting-an-ingress-object-to-get-its-public-ip-address">Inspecting an Ingress object to get its public IP address</h4>
<p>After creating the Ingress object with <code>kubectl apply</code>, you can see its basic information by listing Ingress objects in the current namespace with <code>kubectl get ingresses</code> as follows:</p>
<pre><code class="lang-shell">$ kubectl get ingresses
NAME                CLASS   HOSTS               ADDRESS       PORTS   AGE
kiada-example-com   nginx   kiada.example.com   11.22.33.44   80      30s
</code></pre>
<p><div class="alert alert-info hints-alert"><div class="hints-icon"><i class="fa fa-info-circle"></i></div><div class="hints-container"><p>NOTE</p>
<p>You can use <code>ing</code> as a shorthand for <code>ingress</code>.</p>
</div></div></p>
<p>To see the Ingress object in detail, use the <code>kubectl describe</code> command as follows:</p>
<pre><code class="lang-shell">$ kubectl describe ing kiada-example-com
Name:             kiada-example-com
Namespace:        default
Address:          11.22.33.44
Default backend:  default-http-backend:80 (172.17.0.15:8080)
Rules:
  Host               Path  Backends
  ----               ----  --------
  kiada.example.com
                     /   kiada:80 (172.17.0.4:8080,172.17.0.5:8080,172.17.0.9:8080)
Annotations:         &lt;none&gt;
Events:
  Type    Reason  Age                   From                      Message
  ----    ------  ----                  ----                      -------
  Normal  Sync    5m6s (x2 over 5m28s)  nginx-ingress-controller  Scheduled for sync
</code></pre>
<p>As you can see, the <code>kubectl describe</code> command lists all the rules in the Ingress object. For each rule, not only is the name of the target service shown, but also its endpoints. If you see an error message related to the default backend, ignore it for now. You&#x2019;ll fix it later.</p>
<p>Both <code>kubectl get</code> and <code>kubectl describe</code> display the IP address of the ingress. This is the IP address of the L7 load balancer or reverse proxy to which clients should send requests. In the example output, the IP address is <code>11.22.33.44</code> and the port is <code>80</code>.</p>
<p><div class="alert alert-info hints-alert"><div class="hints-icon"><i class="fa fa-info-circle"></i></div><div class="hints-container"><p>NOTE</p>
<p>The address may not be displayed immediately. This is very common when the cluster is running in the cloud. If the address isn&#x2019;t displayed after several minutes, it means that no ingress controller has processed the Ingress object. Check if the controller is running. Since a cluster can run multiple ingress controllers, it&#x2019;s possible that they&#x2019;ll all ignore your Ingress object if you don&#x2019;t specify which of them should process it. Check the documentation of your chosen ingress controller to find out if you need to add the <code>kubernetes.io/ingress.class</code> annotation or set the <code>spec.ingressClassName</code> field in the Ingress object. You&#x2019;ll learn more about this field later.</p>
</div></div></p>
<p>You can also find the IP address in the Ingress object&#x2019;s <code>status</code> field as follows:</p>
<pre><code class="lang-shell">$ kubectl get ing kiada -o yaml
...
status:
  loadBalancer:
    ingress:
    - ip: 11.22.33.44
</code></pre>
<p><div class="alert alert-info hints-alert"><div class="hints-icon"><i class="fa fa-info-circle"></i></div><div class="hints-container"><p>NOTE</p>
<p>Sometimes the displayed address can be misleading. For example, if you use Minikube and start the cluster in a VM, the ingress address will show up as <code>localhost</code>, but that&#x2019;s only true from the VM&#x2019;s perspective. The actual ingress address is the IP address of the VM, which you can get with the <code>minikube ip</code> command.</p>
</div></div></p>
<h4 id="adding-the-ingress-ip-to-the-dns">Adding the ingress IP to the DNS</h4>
<p>After you add an Ingress to a production cluster, the next step is to add a record to your Internet domain&#x2019;s DNS server. In these examples, we assume that you own the domain <code>example.com</code>. To allow external clients to access your service through the ingress, you configure the DNS server to resolve the domain name <code>kiada.example.com</code> to the ingress IP <code>11.22.33.44</code>.</p>
<p>In a local development cluster, you don&#x2019;t have to deal with DNS servers. Since you&#x2019;re only accessing the service from your own computer, you can get it to resolve the address by other means. This is explained next, along with instructions on how to access the service through the ingress.</p>
<h4 id="accessing-services-through-the-ingress">Accessing services through the ingress</h4>
<p>Since ingresses use virtual hosting to figure out where to forward the request, you won&#x2019;t get the desired result by simply sending an HTTP request to the Ingress&#x2019; IP address and port. You need to make sure that the <code>Host</code> header in the HTTP request matches one of the rules in the Ingress object.</p>
<p>To achieve this, you must tell the HTTP client to send the request to the host <code>kiada.example.com</code>. However, this requires resolving the host to the Ingress IP. If you use <code>curl</code>, you can do this without having to configure your DNS server or your local <code>/etc/hosts</code> file. Let&#x2019;s take <code>11.22.33.44</code> as the ingress IP. You can access the <code>kiada</code> service through the ingress with the following command:</p>
<pre><code class="lang-shell">$ curl --resolve kiada.example.com:80:11.22.33.44 http://kiada.example.com -v
* Added kiada.example.com:80:11.22.33.44 to DNS cache
* Hostname kiada.example.com was found in DNS cache
*   Trying 11.22.33.44:80...
* Connected to kiada.example.com (11.22.33.44) port 80 (#0)
&gt; GET / HTTP/1.1
&gt; Host: kiada.example.com
&gt; User-Agent: curl/7.76.1
&gt; Accept: */*
...
</code></pre>
<p>The <code>--resolve</code> option adds the hostname <code>kiada.example.com</code> to the DNS cache. This ensures that <code>kiada.example.com</code> resolves to the ingress IP. Curl then opens the connection to the ingress and sends the HTTP request. The <code>Host</code> header in the request is set to <code>kiada.example.com</code> and this allows the ingress to forward the request to the correct service.</p>
<p>Of course, if you want to use your web browser instead, you can&#x2019;t use the <code>--resolve</code> option. Instead, you can add the following entry to your <code>/etc/hosts</code> file.</p>
<pre><code class="lang-shell">11.22.33.44    kiada.example.com
</code></pre>
<p><div class="alert alert-info hints-alert"><div class="hints-icon"><i class="fa fa-info-circle"></i></div><div class="hints-container"><p>NOTE</p>
<p>On Windows, the hosts file is usually located at <code>C:\Windows\System32\Drivers\etc\hosts</code>.</p>
</div></div></p>
<p>You can now access the service at <a href="http://kiada.example.com" target="_blank">http://kiada.example.com</a> with your web browser or <code>curl</code> without having to use the <code>--resolve</code> option to map the hostname to the IP.</p>
<h2 id="1222-path-based-ingress-traffic-routing">12.2.2 Path-based ingress traffic routing</h2>
<p>An Ingress object can contain many rules and therefore map multiple hosts and paths to multiple services. You&#x2019;ve already created an Ingress for the <code>kiada</code> service. Now you&#x2019;ll create one for the <code>quote</code> and <code>quiz</code> services.</p>
<p>The Ingress object for these two services makes them available through the same host: <code>api.example.com</code>. The path in the HTTP request determines which service receives each request. As you can see in the following figure, all requests with the path <code>/quote</code> are forwarded to the <code>quote</code> service, and all requests whose path starts with <code>/questions</code> are forwarded to the <code>quiz</code> service.</p>
<p>Figure 12.5 Path-based ingress traffic routing
<img src="../images/12.5.png" alt=""></p>
<p>The following listing shows the Ingress manifest.</p>
<p>Listing 12.3 Ingress mapping request paths to different services</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> networking.k8s.io/v1
<span class="hljs-attr">kind:</span> Ingress
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> api-example-com
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  rules:</span>
<span class="hljs-attr">  - host:</span> api.example.com
<span class="hljs-attr">    http:</span>
<span class="hljs-attr">      paths:</span>
<span class="hljs-attr">      - path:</span> /quote
<span class="hljs-attr">        pathType:</span> Exact
<span class="hljs-attr">        backend:</span>
<span class="hljs-attr">          service:</span>
<span class="hljs-attr">            name:</span> quote
<span class="hljs-attr">            port:</span>
<span class="hljs-attr">              name:</span> http
<span class="hljs-attr">      - path:</span> /questions
<span class="hljs-attr">        pathType:</span> Prefix
<span class="hljs-attr">        backend:</span>
<span class="hljs-attr">          service:</span>
<span class="hljs-attr">            name:</span> quiz
<span class="hljs-attr">            port:</span>
<span class="hljs-attr">              name:</span> http
</code></pre>
<p>In the Ingress object shown in the listing, a single rule with two paths is defined. The rule matches HTTP requests with the host <code>api.example.com</code>. In this rule, the <code>paths</code> array contains two entries. The first matches requests that ask for the <code>/quote</code> path and forwards them to the port named <code>http</code> in the <code>quote</code> Service object. The second entry matches all requests whose first path element is <code>/questions</code> and forwards them to the port <code>http</code> of the <code>quiz</code> service.</p>
<p><div class="alert alert-info hints-alert"><div class="hints-icon"><i class="fa fa-info-circle"></i></div><div class="hints-container"><p>NOTE</p>
<p>By default, no URL rewriting is performed by the ingress proxy. If the client requests the path <code>/quote</code>, the path in the request that the proxy makes to the backend service is also <code>/quote</code>. In some ingress implementations, you can change this by specifying a URL rewrite rule in the Ingress object.</p>
</div></div></p>
<p>After you create the Ingress object from the manifest in the previous listing, you can access the two services it exposes as follows (replace the IP with that of your ingress):</p>
<pre><code class="lang-shell">$ curl --resolve api.example.com:80:11.22.33.44 api.example.com/quote
$ curl --resolve api.example.com:80:11.22.33.44 api.example.com/questions/random
</code></pre>
<p>If you want to access these services with your web browser, add <code>api.example.com</code> to the line you added earlier to your <code>/etc/hosts</code> file. It should now look like this:</p>
<pre><code class="lang-shell">11.22.33.44    kiada.example.com api.example.com
</code></pre>
<h4 id="understanding-how-the-path-is-matched">Understanding how the path is matched</h4>
<p>Did you notice the difference between the <code>pathType</code> fields in the two entries in the previous listing? The <code>pathType</code> field specifies how the path in the request is matched with the paths in the ingress rule. The three supported values are summarized in the following table.</p>
<p>Table 12.1 Supported values in the pathType field</p>
<table>
<thead>
<tr>
<th>PathType</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Exact</td>
<td>The requested URL path must exactly match the path specified in the ingress rule.</td>
</tr>
<tr>
<td>Prefix</td>
<td>The requested URL path must begin with the path specified in the ingress rule, element by element.</td>
</tr>
<tr>
<td>ImplementationSpecific</td>
<td>Path matching depends on the implementation of the ingress controller.</td>
</tr>
</tbody>
</table>
<p>If multiple paths are specified in the ingress rule and the path in the request matches more than one path in the rule, priority is given to paths with the <code>Exact</code> path type.</p>
<h4 id="matching-paths-using-the-exact-path-type">Matching paths using the Exact path type</h4>
<p>The following table shows examples of how matching works when <code>pathType</code> is set to <code>Exact</code>.</p>
<p>Table 12.2 Request paths matched when pathType is Exact</p>
<table>
<thead>
<tr>
<th>Path in rule</th>
<th>Matches request path</th>
<th>Doesn&#x2019;t match</th>
</tr>
</thead>
<tbody>
<tr>
<td>/</td>
<td>/</td>
<td>/foo <br>/bar</td>
</tr>
<tr>
<td>/foo</td>
<td>/foo</td>
<td>/foo/ <br> /bar</td>
</tr>
<tr>
<td>/foo/</td>
<td>/foo/</td>
<td>/foo <br> /foo/bar <br> /bar</td>
</tr>
<tr>
<td>/FOO</td>
<td>/FOO</td>
<td>/foo</td>
</tr>
</tbody>
</table>
<p>As you can see from the examples in the table, the matching works as you&#x2019;d expect. It&#x2019;s case sensitive, and the path in the request must exactly match the <code>path</code> specified in the ingress rule.</p>
<h4 id="matching-paths-using-the-prefix-path-type">Matching paths using the Prefix path type</h4>
<p>When <code>pathType</code> is set to <code>Prefix</code>, things aren&#x2019;t as you might expect. Consider the examples in the following table.</p>
<p>Table 12.3 Request paths matched when pathType is Prefix</p>
<table>
<thead>
<tr>
<th>Path in rule</th>
<th>Matches request paths</th>
<th>Doesn&#x2019;t match</th>
</tr>
</thead>
<tbody>
<tr>
<td>/</td>
<td>All paths; for example: <br>/ <br>/foo <br>/foo/ <br></td>
<td></td>
</tr>
<tr>
<td>/foo <br> or <br> /foo/<br></td>
<td>/foo <br> /foo/ <br> /foo/bar</td>
<td>/foobar <br>/bar</td>
</tr>
<tr>
<td>/FOO</td>
<td>/FOO</td>
<td>/foo</td>
</tr>
</tbody>
</table>
<p>The request path isn&#x2019;t treated as a string and checked to see if it begins with the specified prefix. Instead, both the path in the rule and the request path are split by <code>/</code> and then each element of the request path is compared to the corresponding element of the prefix. Take the path <code>/foo</code>, for example. It matches the request path <code>/foo/bar</code>, but not <code>/foobar</code>. It also doesn&#x2019;t match the request path <code>/fooxyz/bar</code>.</p>
<p>When matching, it doesn&#x2019;t matter if the path in the rule or the one in the request ends with a forward slash. As with the <code>Exact</code> path type, matching is case sensitive.</p>
<h4 id="matching-paths-using-the-implementationspecific-path-type">Matching paths using the ImplementationSpecific path type</h4>
<p>The <code>ImplementationSpecific</code> path type is, as the name implies, dependent on the implementation of the ingress controller. With this path type, each controller can set its own rules for matching the request path. For example, in GKE you can use wildcards in the path. Instead of using the <code>Prefix</code> type and setting the path to <code>/foo</code>, you can set the type to <code>ImplementationSpecific</code> and the path to <code>/foo/*</code>.</p>
<h2 id="1223-using-multiple-rules-in-an-ingress-object">12.2.3 Using multiple rules in an Ingress object</h2>
<p>In the previous sections you created two Ingress objects to access the Kiada suite services. In most Ingress implementations, each Ingress object requires its own public IP address, so you&#x2019;re now probably using two public IP addresses. Since this is potentially costly, it&#x2019;s better to consolidate the Ingress objects into one.</p>
<h4 id="creating-an-ingress-object-with-multiple-rules">Creating an Ingress object with multiple rules</h4>
<p>Because an Ingress object can contain multiple rules, it&#x2019;s trivial to combine multiple objects into one. All you have to do is take the rules and put them into the same Ingress object, as shown in the following listing. You can find the manifest in the file <code>ing.kiada.yaml</code>.</p>
<p>Listing 12.4 Ingress exposing multiple services on different hosts</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> networking.k8s.io/v1
<span class="hljs-attr">kind:</span> Ingress
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> kiada
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  rules:</span>
<span class="hljs-attr">  - host:</span> kiada.example.com
<span class="hljs-attr">    http:</span>
<span class="hljs-attr">      paths:</span>
<span class="hljs-attr">      - path:</span> /
<span class="hljs-attr">        pathType:</span> Prefix
<span class="hljs-attr">        backend:</span>
<span class="hljs-attr">          service:</span>
<span class="hljs-attr">            name:</span> kiada
<span class="hljs-attr">            port:</span>
<span class="hljs-attr">              name:</span> http
<span class="hljs-attr">  - host:</span> api.example.com
<span class="hljs-attr">    http:</span>
<span class="hljs-attr">      paths:</span>
<span class="hljs-attr">      - path:</span> /quote
<span class="hljs-attr">        pathType:</span> Exact
<span class="hljs-attr">        backend:</span>
<span class="hljs-attr">          service:</span>
<span class="hljs-attr">            name:</span> quote
<span class="hljs-attr">            port:</span>
<span class="hljs-attr">              name:</span> http
<span class="hljs-attr">      - path:</span> /questions
<span class="hljs-attr">        pathType:</span> Prefix
<span class="hljs-attr">        backend:</span>
<span class="hljs-attr">          service:</span>
<span class="hljs-attr">            name:</span> quiz
<span class="hljs-attr">            port:</span>
<span class="hljs-attr">              name:</span> http
</code></pre>
<p>This single Ingress object handles all traffic for all services in the Kiada suite yet only requires a single public IP address.</p>
<p>The Ingress object uses virtual hosts to route traffic to the backend services. If the value of the <code>Host</code> header in the request is <code>kiada.example.com</code>, the request is forwarded to the <code>kiada</code> service. If the header value is <code>api.example.com</code>, the request is routed to one of the other two services, depending on the requested path. The Ingress and the associated Service objects are shown in the next figure.</p>
<p>Figure 12.6 An Ingress object covering all services of the Kiada suite</p>
<p><img src="../images/12.6.png" alt=""></p>
<p>You can delete the two Ingress objects you created earlier and replace them with the one in the previous listing. Then you can try to access all three services through this ingress. Since this is a new Ingress object, its IP address is most likely not the same as before. So you need to update the DNS, the <code>/etc/hosts</code> file, or the <code>--resolve</code> option when you run the <code>curl</code> command again.</p>
<h4 id="using-wildcards-in-the-host-field">Using wildcards in the host field</h4>
<p>The <code>host</code> field in the ingress rules supports the use of wildcards. This allows you to capture all requests sent to a host that matches <code>*.example.com</code> and forward them to your services. The following table shows how wildcard matching works.</p>
<p>Table 12.4 Examples of using wildcards in the ingress rule&#x2019;s host field</p>
<table>
<thead>
<tr>
<th>Host</th>
<th>Matches request hosts</th>
<th>Doesn&#x2019;t match</th>
</tr>
</thead>
<tbody>
<tr>
<td>kiada.example.com</td>
<td>kiada.example.com</td>
<td>example.com <br> api.example.com <br> foo.kiada.example.com</td>
</tr>
<tr>
<td>*.example.com</td>
<td>kiada.example.com <br> api.example.com <br> foo.example.com</td>
<td>example.com <br>foo.kiada.example.com</td>
</tr>
</tbody>
</table>
<p>Look at the example with the wildcard. As you can see, <code>*.example.com</code> matches <code>kiada.example.com</code>, but it doesn&#x2019;t match <code>foo.kiada.example.com</code> or <code>example.com</code>. This is because a wildcard only covers a single element of the DNS name.</p>
<p>As with rule paths, a rule that exactly matches the host in the request takes precedence over rules with host wildcards.</p>
<p><div class="alert alert-info hints-alert"><div class="hints-icon"><i class="fa fa-info-circle"></i></div><div class="hints-container"><p>NOTE</p>
<p>You can also omit the <code>host</code> field altogether to make the rule match any host.</p>
</div></div></p>
<h2 id="1224-setting-the-default-backend">12.2.4 Setting the default backend</h2>
<p>If the client request doesn&#x2019;t match any rules defined in the Ingress object, the response <code>404 Not Found</code> is normally returned. However, you can also define a default backend to which the ingress should forward the request if no rules are matched. The default backend serves as a catch-all rule.</p>
<p>The following figure shows the default backend in the context of the other rules in the Ingress object.</p>
<p>Figure 12.7 The default backend handles requests that match no Ingress rule</p>
<p><img src="../images/12.7.png" alt=""></p>
<p>As you can see in the figure, a service named <code>fun404</code> is used as the default backend. Let&#x2019;s add it to the <code>kiada</code> Ingress object.</p>
<h4 id="specifying-the-default-backend-in-an-ingress-object">Specifying the default backend in an Ingress object</h4>
<p>You specify the default backend in the <code>spec.defaultBackend</code> field, as shown in the following listing (the full manifest can be found in the <code>ing.kiada.defaultBackend.yaml</code> file).</p>
<p>Listing 12.5 Specifying the default backend in the Ingress object</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> networking.k8s.io/v1
<span class="hljs-attr">kind:</span> Ingress
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> kiada
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  defaultBackend:</span>
<span class="hljs-attr">    service:</span>
<span class="hljs-attr">      name:</span> fun404
<span class="hljs-attr">      port:</span>
<span class="hljs-attr">        name:</span> http
<span class="hljs-attr">  rules:</span>
  ...
</code></pre>
<p>In the listing, you can see that setting the default backend isn&#x2019;t much different from setting the backend in the rules. Just as you specify the <code>name</code> and <code>port</code> of the backend service in each rule, you also specify the name and port of the default backend service in the <code>service</code> field under <code>spec.defaultBackend</code>.</p>
<h4 id="creating-the-service-and-pod-for-the-default-backend">Creating the service and pod for the default backend</h4>
<p>The <code>kiada</code> Ingress object is configured to forward requests that don&#x2019;t match any rules to a service called <code>fun404</code>. You need to create this service and the underlying pod. You can find an object manifest with both object definitions in the file <code>all.my-default-backend</code>.yaml. The contents of the file are shown in the following listing.</p>
<p>Listing 12.6 The Pod and Service object manifests for the default ingress backend</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> fun404
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    app:</span> fun404
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> server
<span class="hljs-attr">    image:</span> luksa/static-http-server
<span class="hljs-attr">    args:</span>
<span class="hljs-bullet">    -</span> --listen-port=<span class="hljs-number">8080</span>
<span class="hljs-bullet">    -</span> --response-code=<span class="hljs-number">404</span>
<span class="hljs-bullet">    -</span> --text=This isn<span class="hljs-string">&apos;t the URL you&apos;</span>re looking for.
<span class="hljs-attr">    ports:</span>
<span class="hljs-attr">    - name:</span> http
<span class="hljs-attr">      containerPort:</span> <span class="hljs-number">8080</span>
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Service
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> fun404
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    app:</span> fun404
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    app:</span> fun404
<span class="hljs-attr">  ports:</span>
<span class="hljs-attr">  - name:</span> http
<span class="hljs-attr">    port:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">    targetPort:</span> http
</code></pre>
<p>After applying both the Ingress object manifest and the Pod and Service object manifest, you can test the default backend by sending a request that doesn&#x2019;t match any of the rules in the ingress. For example:</p>
<pre><code class="lang-shell">$ curl api.example.com/unknown-path --resolve api.example.com:80:11.22.33.44
This isn&apos;t the URL you&apos;re looking for.
</code></pre>
<p>As expected, the response text matches what you configured in the <code>fun404</code> pod. Of course, instead of using the default backend to return a custom <code>404</code> status, you can use it to forward all requests to default to a service of your choice.</p>
<p>You can even create an Ingress object with only a default backend and no rules to forward all external traffic to a single service. If you&#x2019;re wondering why you&#x2019;d do this using an Ingress object and not by simply setting the service type to LoadBalancer, it&#x2019;s because ingresses can provide additional HTTP features that services can&#x2019;t. One example is securing the communication between the client and the service with Transport Layer Security (TLS), which is explained next.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="Introducing_Ingresses.html" class="navigation navigation-prev " aria-label="Previous page: 12.1 Introducing Ingresses">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="Configuring_TLS_for_an_Ingress.html" class="navigation navigation-next " aria-label="Next page: 12.3 Configuring TLS for an Ingress">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"12.2 Creating and using Ingress objects","level":"4.9.2","depth":2,"next":{"title":"12.3 Configuring TLS for an Ingress","level":"4.9.3","depth":2,"path":"docs/Configuring_TLS_for_an_Ingress.md","ref":"docs/Configuring_TLS_for_an_Ingress.md","articles":[]},"previous":{"title":"12.1 Introducing Ingresses","level":"4.9.1","depth":2,"path":"docs/Introducing_Ingresses.md","ref":"docs/Introducing_Ingresses.md","articles":[]},"dir":"ltr"},"config":{"plugins":["page-toc-button","cnzz","hints","sitemap-general"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"search":{},"cnzz":{"style":"1","visible":true,"siteid":"1278605528"},"hints":{"danger":"fa fa-bug","info":"fa fa-info-circle","tip":"fa fa-sticky-note","working":"fa fa-cog fa-spin"},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sitemap-general":{"prefix":"https://wangwei1237.gitee.io/kubernetes-in-action-second-edition"},"fontsettings":{"theme":"white","family":"serif","size":2},"highlight":{},"page-toc-button":{"maxTocDepth":2,"minTocSize":2},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"wangwei17","pdf":{"pageBreaksBefore":"/","headerTemplate":null,"paperSize":"a4","margin":{"right":62,"left":62,"top":36,"bottom":36},"fontSize":16,"fontFamily":"Arial","footerTemplate":null,"chapterMark":"pagebreak","pageNumbers":true},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"isbn":"","variables":{},"title":"Kubernetes实战（第二版）","links":{"sharing":{"all":null,"facebook":null,"google":null,"twitter":null,"weibo":null},"sidebar":{"17哥的个人网站":"https://wangwei1237.gitee.io/"}},"gitbook":"*","description":"Kubernetes实战（第二版）","extension":null},"file":{"path":"docs/Creating_and_using_Ingress_objects.md","mtime":"2023-03-23T08:34:40.354Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2023-03-23T08:35:06.207Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-page-toc-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-cnzz/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

