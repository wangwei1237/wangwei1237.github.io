<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-Hans" xml:lang="zh-Hans"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>13&nbsp; 质量控制 – Introduction to Probability and Statistics for Engineers and Scientists（中文版）</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapter_14/14.html" rel="next">
<link href="../chapter_12/12.html" rel="prev">
<link href="../favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-cb4e7b2c32f83f6f4e8c888918fcdddf.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "没有结果",
    "search-matching-documents-text": "匹配的文档",
    "search-copy-link-title": "复制搜索链接",
    "search-hide-matches-text": "隐藏其它匹配结果",
    "search-more-match-text": "更多匹配结果",
    "search-more-matches-text": "更多匹配结果",
    "search-clear-button-title": "清除",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "取消",
    "search-submit-button-title": "提交",
    "search-label": "搜索"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="13&nbsp; 质量控制 – Introduction to Probability and Statistics for Engineers and Scientists（中文版）">
<meta property="og:description" content="">
<meta property="og:image" content="https://wangwei1237.github.io/introduction_to_probability_and_statistics/chapter_13/13_files/figure-html/fig-13_1-1.png">
<meta property="og:site_name" content="Introduction to Probability and Statistics for Engineers and Scientists（中文版）">
<meta property="og:image:height" content="960">
<meta property="og:image:width" content="1344">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../favicon.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Introduction to Probability and Statistics for Engineers and Scientists（中文版）</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="搜索"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="展开或折叠导航栏" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://wangwei1237.github.io/"> <i class="bi bi-house-fill" role="img">
</i> 
<span class="menu-text">博客</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-bookshelf" role="img">
</i> 
 <span class="menu-text">书籍</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-">    
        <li>
    <a class="dropdown-item" href="https://zh.d2l.ai/">
 <span class="dropdown-text">动手学深度学习</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://learnprompting.org/zh-Hans/docs/intro">
 <span class="dropdown-text">Learn Prompting</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://pan.baidu.com/s/1dciwgbhO-lfKyRo8lOqW9Q?pwd=cm9q">
 <span class="dropdown-text">Stabel Diffusion 提示词手册</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="https://wangwei1237.github.io/aboutme/"> <i class="bi bi-person-badge-fill" role="img">
</i> 
<span class="menu-text">关于</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://github.com/wangwei1237/introduction_to_probability_and_statistics" title="源代码" class="quarto-navigation-tool px-1" aria-label="源代码"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="展开或折叠侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapter_13/13.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">质量控制</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="展开或折叠侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">欢迎阅读</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../preface_17.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">译者序</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">序言</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_1/1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">统计学简介</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_2/2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">描述统计</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_3/3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">概率论基础</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_4/4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">随机变量和期望</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_5/5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">特殊的随机变量</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_6/6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">抽样分布</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_7/7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">参数估计</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_8/8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">假设检验</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_9/9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">回归</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_10/10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">方差分析</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_11/11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">拟合优度检验和分类数据分析</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_12/12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">非参数假设检验</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_13/13.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">质量控制</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_14/14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Life testing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_15/15.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Simulation, bootstrap statistical methods, and permutation tests</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_16/16.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Machine learning and big data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">测试脚本</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">附录</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">表格</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">目录</h2>
   
  <ul>
  <li><a href="#sec-13_1" id="toc-sec-13_1" class="nav-link active" data-scroll-target="#sec-13_1"><span class="header-section-number">13.1</span> Introduction</a></li>
  <li><a href="#sec-13_2" id="toc-sec-13_2" class="nav-link" data-scroll-target="#sec-13_2"><span class="header-section-number">13.2</span> 基于平均值构建控制图：<span class="math inline">\(\overline{x}\)</span> 控制图</a>
  <ul class="collapse">
  <li><a href="#sec-13_2_1" id="toc-sec-13_2_1" class="nav-link" data-scroll-target="#sec-13_2_1"><span class="header-section-number">13.2.1</span> <span class="math inline">\(\mu\)</span>、<span class="math inline">\(\sigma\)</span> 未知的场景</a></li>
  </ul></li>
  <li><a href="#sec-13_3" id="toc-sec-13_3" class="nav-link" data-scroll-target="#sec-13_3"><span class="header-section-number">13.3</span> <span class="math inline">\(\text{S}\)</span>-控制图</a></li>
  <li><a href="#sec-13_4" id="toc-sec-13_4" class="nav-link" data-scroll-target="#sec-13_4"><span class="header-section-number">13.4</span> 不合格品率控制图</a></li>
  <li><a href="#sec-13_5" id="toc-sec-13_5" class="nav-link" data-scroll-target="#sec-13_5"><span class="header-section-number">13.5</span> 缺陷数控制图</a></li>
  <li><a href="#sec-13_6" id="toc-sec-13_6" class="nav-link" data-scroll-target="#sec-13_6"><span class="header-section-number">13.6</span> 用于检测总体均值变化的控制图</a>
  <ul class="collapse">
  <li><a href="#sec-13_6_1" id="toc-sec-13_6_1" class="nav-link" data-scroll-target="#sec-13_6_1"><span class="header-section-number">13.6.1</span> 移动平均控制图</a></li>
  <li><a href="#13_6_2" id="toc-13_6_2" class="nav-link" data-scroll-target="#13_6_2"><span class="header-section-number">13.6.2</span> 指数加权移动平均控制图</a></li>
  <li><a href="#sec-13_6_3" id="toc-sec-13_6_3" class="nav-link" data-scroll-target="#sec-13_6_3"><span class="header-section-number">13.6.3</span> 累计和控制图</a></li>
  </ul></li>
  <li><a href="#problems" id="toc-problems" class="nav-link" data-scroll-target="#problems">Problems</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/wangwei1237/introduction_to_probability_and_statistics/edit/main/chapter_13/13.qmd" class="toc-action"><i class="bi bi-github"></i>编辑该页面</a></li><li><a href="https://github.com/wangwei1237/introduction_to_probability_and_statistics/issues/new" class="toc-action"><i class="bi empty"></i>反馈问题</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-13" class="quarto-section-identifier"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">质量控制</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="sec-13_1" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="sec-13_1"><span class="header-section-number">13.1</span> Introduction</h2>
<div class="callout callout-style-default callout-note callout-titled" title="对过程的解释">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
对过程的解释
</div>
</div>
<div class="callout-body-container callout-body">
<p>在质量控制领域，我们将 <em>process</em> 译作 <em>过程</em>，以强调一系列活动的内在关联性。过程指为了达到某个目标而执行的一系列操作或阶段，这种操作可以是动态的、复杂的，具有系统性和整体性，例如：生产过程、加工过程……</p>
</div>
</div>
<p>几乎每个工厂在生产产品的 <strong>过程</strong> 中都会存在某些 <strong>随机变异</strong>（<em>variation</em>）。也就是说，无论生产 <strong>过程</strong> 控制得多么严格，生产出的产品之间总会存在一些 <strong>差异</strong>（<em>variation</em>）。我们称这种 <strong>差异</strong>（<em>variation</em>）为 <strong>随机变异</strong>（<em>chance variation</em>），并且我们认为这种 <strong>差异</strong>（<em>variation</em>）是生产 <strong>过程</strong> 本身所固有的。</p>
<p>然而，在生产 <strong>过程</strong> 中，还存在另一种类型的 <strong>差异</strong>（<em>variation</em>），这种 <strong>差异</strong>（<em>variation</em>）不是生产 <strong>过程</strong> 本身所固有的，而是由某些 <strong>特定原因</strong>（<em>assignable cause</em>）引起的，并且通常这些 <strong>特定原因</strong>（<em>assignable cause</em>）会对产品质量产生不利影响。例如，这种 <strong>差异</strong>（<em>variation</em>）可能是由机器错误的设置、原材料质量较差、错误的软件、人为错误或其他更多的可能性所导致。当产品表现出的 <strong>差异</strong>（<em>variation</em>）仅由 <strong>随机原因</strong>（<em>chance cause</em>）而不是 <strong>特定原因</strong>（<em>assignable cause</em>）导致时，我们称生产 <strong>过程</strong> 是 <strong>受控</strong>（<em>in control</em>）的。</p>
<p>我们需要解决的一个关键问题就是：确定某个生产 <strong>过程</strong> 是 <strong>受控</strong>（<em>in control</em>） 的还是 <strong>失控</strong>（<em>out of control</em>）的。</p>
<p>我们可以使用 <strong>控制图</strong>（<em>control charts</em>）来简化确定一个 <strong>过程</strong> 是 <strong>受控</strong> 还是 <strong>失控</strong>。<strong>控制图</strong> 由两个数字来确定：<strong>上控制限</strong>（<em>the upper control limits</em>）和 <strong>下控制限</strong>（<em>the lower control limits</em>）。为了使用 <strong>控制图</strong>，我们需要把制造 <strong>过程</strong> 生成的数据分为若干子组，并计算每个子组的统计量（例如，每个子组的平均值和标准差）。当子组的统计量超出 <strong>上下控制限</strong> 时，我们会认为 <strong>过程</strong> 是 <strong>失控</strong> 的。</p>
<ul>
<li>在 <a href="#sec-13_2" class="quarto-xref"><span>小节 13.2</span></a> 和 <a href="#sec-13_3" class="quarto-xref"><span>小节 13.3</span></a> 节中，我们假设连续生产的产品具有某些可测量的特性，当 <strong>过程</strong> <strong>受控</strong> 时，产品的这些特性数据的均值和方差是固定的。我们将会介绍如何基于子组平均值（<a href="#sec-13_2" class="quarto-xref"><span>小节 13.2</span></a> 节）和子组标准差（<a href="#sec-13_3" class="quarto-xref"><span>小节 13.3</span></a> 节）构建控制图。</li>
<li>在 <a href="#sec-13_4" class="quarto-xref"><span>小节 13.4</span></a> 中，我们假设产品不具有某种可测量特性，此时，我们通过某种 <strong>属性</strong>（<em>attribute</em>）将产品分类为“合格”或“不合格”，进而判断产品是否合格。然后我们将展示如何构建 <strong>控制图</strong>（<em>control charts</em>）以指示产品质量的变化。</li>
<li>在 <a href="#sec-13_5" class="quarto-xref"><span>小节 13.5</span></a> 中，我们将考虑具有随机缺陷数量情况下的 <strong>控制图</strong>。</li>
<li>最后，在 <a href="#sec-13_6" class="quarto-xref"><span>小节 13.6</span></a> 中，我们将讨论更复杂的 <strong>控制图</strong>——不仅单独考虑每个子组的数据值，还会综合考虑其他子组的数据值。这类控制图包括三种不同的类型：<strong>移动平均控制图</strong>（<em>moving average control chart</em>）、<strong>指数加权移动平均控制图</strong>（<em>exponential weighted moving average control chart</em>）和 <strong>累积和控制图</strong>（<em>cumulative sum control chart</em>）。</li>
</ul>
</section>
<section id="sec-13_2" class="level2" data-number="13.2">
<h2 data-number="13.2" class="anchored" data-anchor-id="sec-13_2"><span class="header-section-number">13.2</span> 基于平均值构建控制图：<span class="math inline">\(\overline{x}\)</span> 控制图</h2>
<p>假设当 <strong>过程</strong> 处于 <strong>受控</strong> 状态时，连续生产的产品在某个可测特性上的观测数据是独立的、并且服从均值为 <span class="math inline">\(\mu\)</span>、方差为 <span class="math inline">\(\sigma^2\)</span> 的正态分布。然而，由于特殊情况，该 <strong>过程</strong> 可能会失控并且生产出的产品在可观测特性上的数据开始具有不同分布。我们希望能够识别出这种失控的情况，以便停止 <strong>过程</strong>、找出问题所在、并加以修复。</p>
<p>令 <span class="math inline">\(X_1, X_2, \dots\)</span> 表示连续生产的产品的可测量特性。为了确定 <strong>过程</strong> 何时失控，我们将数据分成固定大小（记作 <span class="math inline">\(n\)</span>）的子组。固定大小 <span class="math inline">\(n\)</span> 的选择必须确保各子组内数据的一致性。例如，可以选择 <span class="math inline">\(n\)</span> 以使得各子组内的所有产品都是在同一天、同一批次或同一设置下所生产的。换句话说，<span class="math inline">\(n\)</span> 的具体值的选择，需要使得数据分布的变化更可能的发生在子组之间，而不是子组内部。<span class="math inline">\(n\)</span> 的典型的取值为 4、5 或 6。</p>
<p>令 <span class="math inline">\(\overline{X}_i, i = 1,2,...\)</span> 表示第 <span class="math inline">\(i\)</span> 个子组的平均值，即</p>
<p><span class="math display">\[
\begin{aligned}
\overline{X}_1 &amp;= \frac{X_1 + \cdots + X_n}{n} \\
\overline{X}_2 &amp;= \frac{X_{n+1} + \cdots + X_{2n}}{n}\\
\overline{X}_3 &amp;= \frac{X_{2n+1} + \cdots + X_{3n}}{n} \\
\qquad \qquad &amp; \qquad\vdots
\end{aligned}
\]</span></p>
<p>当 <strong>过程</strong> 受控时，每个 <span class="math inline">\(X_i\)</span> 的均值为 <span class="math inline">\(\mu\)</span> 且方差为 <span class="math inline">\(\sigma^2\)</span>，因此可得：</p>
<p><span class="math display">\[
\begin{aligned}
E(\overline{X}_i) &amp;= \mu \\
\text{Var}(\overline{X}_i) &amp;= \frac{\sigma^2}{n}
\end{aligned}
\]</span></p>
<p>因此</p>
<p><span class="math display">\[
\frac{\overline{X}_i - \mu}{\sqrt{\sigma^2 / n}} \sim \mathcal{N}(0, 1)
\]</span></p>
<p>也就是说，<strong>过程</strong> 连续生产的产品中，如果第 <span class="math inline">\(i\)</span> 个子组中的产品始终处于受控状态，那么随机变量 <span class="math inline">\(\sqrt{n} \frac{\overline{X}_i - \mu}{\sigma}\)</span> 服从标准正态分布。因此，标准正态随机变量 <span class="math inline">\(Z\)</span> 几乎总是位于 <span class="math inline">\(-3\)</span> 和 <span class="math inline">\(+3\)</span> 之间。（实际上，<span class="math inline">\(P\{-3 &lt; Z &lt; 3\} = 0.9973\)</span>。）因此，如果 <strong>过程</strong> 在连续生产的产品中，第 <span class="math inline">\(i\)</span> 个子组的产品始终处于受控状态，那么我们一定可以期望得到：</p>
<p><span class="math display">\[
-3 &lt; \sqrt{n} \frac{\overline{X}_i - \mu}{\sigma} &lt; 3
\]</span></p>
<p>即，</p>
<p><span class="math display">\[
\mu - \frac{3\sigma}{\sqrt{n}} &lt; \overline{X}_i &lt; \mu + \frac{3\sigma}{\sqrt{n}}
\]</span></p>
<p>我们称</p>
<p><span class="math display">\[
\begin{aligned}
\text{UCL} &amp;\equiv \mu + \frac{3\sigma}{\sqrt{n}} \\
\text{LCL} &amp;\equiv \mu - \frac{3\sigma}{\sqrt{n}}
\end{aligned}
\]</span></p>
<p>分别为 <strong>上控制限</strong>（<em>upper control limits</em>）和 <strong>下控制限</strong>（<em>lower control limit</em>）。</p>
<p><span class="math inline">\(\overline{X}\)</span> 控制图的作用是检测产品的平均值是否发生变化，其方法是绘制连续子组的平均值 <span class="math inline">\(\overline{X}_i\)</span>，并在 <span class="math inline">\(\overline{X}_i\)</span> 第一次落在 <span class="math inline">\(\text{LCL}\)</span> 和 <span class="math inline">\(\text{UCL}\)</span> 之外时，判断 <strong>过程</strong> 已经失控（见 <a href="#fig-13_1" class="quarto-xref">图&nbsp;<span>13.1</span></a>）。</p>
<div id="exr-13_2_a" class="theorem exercise">
<p><span class="theorem-title"><strong>习题 13.1</strong></span> 某厂商生产的钢轴直径应服从均值为 3mm、标准差为 0.1mm 的正态分布。连续抽取钢轴样本、并且以 4 个钢轴为一组得到 10 个子组的样本均值（单位：mm）数据如下：</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>样本编号</th>
<th><span class="math inline">\(\overline{X}\)</span></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>3.01</td>
<td></td>
</tr>
<tr class="even">
<td>2</td>
<td>2.97</td>
<td></td>
</tr>
<tr class="odd">
<td>3</td>
<td>3.12</td>
<td></td>
</tr>
<tr class="even">
<td>4</td>
<td>2.99</td>
<td></td>
</tr>
<tr class="odd">
<td>5</td>
<td>3.03</td>
<td></td>
</tr>
<tr class="even">
<td>6</td>
<td>3.02</td>
<td></td>
</tr>
<tr class="odd">
<td>7</td>
<td>3.10</td>
<td></td>
</tr>
<tr class="even">
<td>8</td>
<td>3.14</td>
<td></td>
</tr>
<tr class="odd">
<td>9</td>
<td>3.09</td>
<td></td>
</tr>
<tr class="even">
<td>10</td>
<td>3.20</td>
<td></td>
</tr>
</tbody>
</table>
<p>根据如上的数据，我们应得出什么结论？</p>
</div>
<div id="sol-13_2_a" class="proof solution">
<p><span class="proof-title"><em>解 13.1</em>. </span>当 <strong>过程</strong> 处于受控状态时，连续生产的钢轴直径服从均值 <span class="math inline">\(\mu = 3\)</span>、标准差 <span class="math inline">\(\sigma = 0.1\)</span> 的正态分布。因此，当 <span class="math inline">\(n = 4\)</span> 时：</p>
<p><span class="math display">\[
\begin{aligned}
\text{LCL} &amp;= 3 - \frac{3(0.1)}{\sqrt{4}} = 2.85 \\
\text{UCL} &amp;= 3 + \frac{3(0.1)}{\sqrt{4}} = 3.15
\end{aligned}
\]</span></p>
<p>由于第 10 子组的样本平均值大于 <strong>上控制限</strong>（<em>UCL</em>），因此可以怀疑钢轴的平均直径已经不再是 3mm。（显然，从第 6 到第 10 子组样本的结果来看，其平均直径看起来已经超过了 3mm。）</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>代码</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">3.01</span>, <span class="fl">2.97</span>, <span class="fl">3.12</span>, <span class="fl">2.99</span>, <span class="fl">3.03</span>, <span class="fl">3.02</span>, <span class="fl">3.10</span>, <span class="fl">3.14</span>, <span class="fl">3.09</span>, <span class="fl">3.20</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fu">seq_along</span>(x)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">i=</span>i, <span class="at">x=</span>x)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="dv">3</span>       <span class="co"># 均值</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fl">0.1</span>  <span class="co"># 标准差</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">4</span>        <span class="co"># 子组样本量</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>UCL <span class="ot">&lt;-</span> mu <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> sigma <span class="sc">/</span> <span class="fu">sqrt</span>(n)  <span class="co"># 上控制限</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>LCL <span class="ot">&lt;-</span> mu <span class="sc">-</span> <span class="dv">3</span> <span class="sc">*</span> sigma <span class="sc">/</span> <span class="fu">sqrt</span>(n)  <span class="co"># 下控制限</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> i, <span class="at">y =</span> x)) <span class="sc">+</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">4</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span>  <span class="co"># 绘制均值点</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_line(aes(group = 1), color = "black") +  # 连接均值点的线</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> UCL, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># 上控制限</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> LCL, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># 下控制限</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> mu, <span class="at">color =</span> <span class="st">"gray"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># 中心线</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">11</span>, <span class="at">y =</span> UCL, <span class="at">label =</span> <span class="st">"UCL"</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span>  <span class="co"># 标注UCL</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">11</span>, <span class="at">y =</span> LCL, <span class="at">label =</span> <span class="st">"LCL"</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">1.5</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span>  <span class="co"># 标注LCL</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">10</span>, <span class="at">y =</span> x[<span class="dv">10</span>], <span class="at">label =</span> <span class="st">"Out of control"</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span>  <span class="co"># 标注失控点</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>df[<span class="dv">10</span>, ], <span class="fu">aes</span>(<span class="at">x =</span> i, <span class="at">y =</span> x), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">shape =</span> <span class="dv">4</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span>  <span class="co"># 突出显示失控点</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Control Chart"</span>, <span class="at">x =</span> <span class="st">"Subgroup"</span>, <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">bar</span>(X))) <span class="sc">+</span>  <span class="co"># 添加标题和轴标签</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">12</span>),</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()  <span class="co"># 使用简洁主题</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-13_1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-13_1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="13_files/figure-html/fig-13_1-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-13_1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;13.1: <span class="math inline">\(\overline{X}\)</span> 的控制图，其中 <span class="math inline">\(n = 4\)</span>
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="备注">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
备注
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p>在如上的控制图中，我们假定当 <strong>过程</strong> 处于受控状态时，数据分布服从正态分布。然而，根据中心极限定理（<a href="../chapter_6/6.html#sec-6_3" class="quarto-xref"><span>小节 6.3</span></a>），即使数据分布不服从正态分布，各子组均值的分布也应大致服从正态分布。因此，各子组均值也不太可能偏离其平均值 的 3 个标准差。</p></li>
<li><p>通常情况下，我们并不能确定所有生产产品的可测量质量，因此只能通过随机选择的产品来确定 <strong>过程</strong> 的质量。因此，我们自然的会选择同时生产的产品作为一个子组。</p></li>
</ul>
<p>需要注意的是，即使 <strong>过程</strong> 处于受控状态，子组均值也有概率位于控制界限之外，以 <a href="#exr-13_2_a" class="quarto-xref">习题&nbsp;<span>13.1</span></a> 的数据为例，位于控制界限之外的概率是 0.0027。因此，我们可能会错误地停止 <strong>过程</strong> 并去寻找那些本来就不存在的问题源。</p>
<p>假设 <strong>过程</strong> 刚刚失控，并且测量数据的均值从 <span class="math inline">\(\mu\)</span> 变为 <span class="math inline">\(\mu + a\)</span>，其中 <span class="math inline">\(a &gt; 0\)</span>。如果之后没有进一步变化，那么需要多长时间才能从控制图上观察到 <strong>过程</strong> 已经失控？为了回答这个问题，子组均值落在控制界限内的条件是：</p>
<p><span class="math inline">\(-3 &lt; \sqrt{n} \frac{\overline{X} - \mu}{\sigma} &lt; 3\)</span></p>
<p>即，</p>
<p><span class="math inline">\(-3 - \frac{a \sqrt{n}}{\sigma} &lt; \sqrt{n} \frac{\overline{X} - \mu}{\sigma} - \frac{a\sqrt{n}}{\sigma} &lt; 3 - \frac{a \sqrt{n}}{\sigma}\)</span></p>
<p>所以，</p>
<p><span class="math inline">\(-3 - \frac{a \sqrt{n}}{\sigma} &lt; \sqrt{n} \frac{\overline{X} - \mu - a}{\sigma} &lt; 3 - \frac{a \sqrt{n}}{\sigma}\)</span></p>
<p>因此，子组均值 <span class="math inline">\(\overline{X}\)</span> 服从均值为 <span class="math inline">\(\mu + a\)</span>、方差为 <span class="math inline">\(\sigma^2 / n\)</span> 的正态分布。因此，</p>
<p><span class="math inline">\(\sqrt{n}\frac{\overline{X} - \mu - a}{\sigma}\)</span> 服从标准正态分布，其落在控制界限内的概率为：</p>
<p><span class="math display">\[
\begin{aligned}
P \left\{ -3 - \frac{a \sqrt{n}}{\sigma} &lt; Z &lt; 3 - \frac{a \sqrt{n}}{\sigma} \right\} &amp;= \Phi \left( 3 - \frac{a \sqrt{n}}{\sigma} \right) - \Phi \left( -3 - \frac{a \sqrt{n}}{\sigma} \right) \\
&amp;\approx \Phi \left( 3 - \frac{a \sqrt{n}}{\sigma} \right)
\end{aligned}
\]</span></p>
<p>因此，落在控制界限外的概率约为：</p>
<p><span class="math inline">\(1 - \Phi \left( 3 - \frac{a \sqrt{n}}{\sigma} \right)\)</span></p>
<p>例如，如果子组大小 <span class="math inline">\(n = 4\)</span>，均值增加 <span class="math inline">\(1\)</span> 个标准差，即 <span class="math inline">\(a = \sigma\)</span>，那么子组均值落在控制界限之外的概率为：</p>
<p><span class="math inline">\(1 - \Phi(1) \approx 0.1587\)</span></p>
<p>由于每个子组均值落在控制界限之外都是相互独立的，切其概率为 <span class="math inline">\(1 - \Phi \left( 3 - \frac{a \sqrt{n}}{\sigma} \right)\)</span>，因此检测到此变化所需的子组数量服从几何分布，其均值为：</p>
<p><span class="math inline">\(\left[ 1 - \Phi \left( 3 - \frac{a \sqrt{n}}{\sigma} \right) \right]^{-1}\)</span></p>
<p>在 <span class="math inline">\(n = 4\)</span> 的情况下，如果均值变化为 1 个标准差，为检测均值发生 1 个标准差变化，需要绘制的子组数量服从几何分布，其均值为：</p>
<p><span class="math inline">\(\frac{1}{0.1587} \approx 6.301\)</span>。</p>
</div>
</div>
<section id="sec-13_2_1" class="level3" data-number="13.2.1">
<h3 data-number="13.2.1" class="anchored" data-anchor-id="sec-13_2_1"><span class="header-section-number">13.2.1</span> <span class="math inline">\(\mu\)</span>、<span class="math inline">\(\sigma\)</span> 未知的场景</h3>
<p>如果我们刚开始使用控制图，并且没有可靠的历史数据，那么 <span class="math inline">\(\mu\)</span> 和 <span class="math inline">\(\sigma\)</span> 则都是未知的。此时，我们需要估计 <span class="math inline">\(\mu\)</span> 和 <span class="math inline">\(\sigma\)</span>。为此，我们使用 <span class="math inline">\(k\)</span> 个子组，其中 <span class="math inline">\(k\)</span> 应满足 <span class="math inline">\(k \geq 20\)</span> 且 <span class="math inline">\(nk \geq 100\)</span>。如果 <span class="math inline">\(\overline{X}_i,\ i = 1, \ldots, k\)</span> 是第 <span class="math inline">\(i\)</span> 个子组的平均值，那么可以通过这些子组平均值的均值 <span class="math inline">\(\overline{\overline{X}}\)</span> 来估计 <span class="math inline">\(\mu\)</span>，即：</p>
<p><span class="math display">\[
\overline{\overline{X}} = \frac{\overline{X}_1 + \cdots + \overline{X}_k}{k}
\]</span></p>
<p>为了估计 <span class="math inline">\(\sigma\)</span>，令 <span class="math inline">\(S_i\)</span> 表示第 <span class="math inline">\(i\)</span> 个子组的样本标准差，其中 <span class="math inline">\(i = 1, \ldots, k\)</span>。即：</p>
<p><span class="math display">\[
\begin{aligned}
S_1 &amp;= \sqrt{\frac{\sum_{i=1}^n (X_i - \overline{X}_1)^2}{n-1}} \\
S_2 &amp;= \sqrt{\frac{\sum_{i=1}^n (X_{n+i} - \overline{X}_2)^2}{n-1}} \\
\quad &amp; \quad \vdots \\
S_k &amp;= \sqrt{\frac{\sum_{i=1}^n (X_{(k-1)n+i} - \overline{X}_k)^2}{n-1}}
\end{aligned}
\]</span></p>
<p>令：</p>
<p><span class="math display">\[
\overline{S} = \frac{S_1 + \cdots + S_k}{k}
\]</span></p>
<p>统计量 <span class="math inline">\(\overline{S}\)</span> 并不是 <span class="math inline">\(\sigma\)</span> 的无偏估计，即 <span class="math inline">\(E[\overline{S}] \neq \sigma\)</span>。为了将 <span class="math inline">\(\overline{S}\)</span> 转化为无偏估计，我们首先计算 <span class="math inline">\(E[\overline{S}]\)</span>：</p>
<p><span id="eq-13_2_1"><span class="math display">\[
E[\overline{S}] = \frac{E[S_1] + \cdots + E[S_k]}{k} = E[S_1]
\tag{13.1}\]</span></span></p>
<p>最后一个等式成立是因为 <span class="math inline">\(S_1, \ldots, S_k\)</span> 是独立且同分布的（因此具有相同的均值）。为了计算 <span class="math inline">\(E[S_1]\)</span>，我们需要用到 <a href="../chapter_6/6.html#thm-6_5_1" class="quarto-xref">定理&nbsp;<span>6.2</span></a> 中的正态分布样本的基本概念，即：</p>
<p><span id="eq-13_2_2"><span class="math display">\[
(n-1)\frac{S_1^2}{\sigma^2} = \sum_{i=1}^n \frac{(X_i - \overline{X}_1)^2}{\sigma^2} \sim \chi^2_{n-1}
\tag{13.2}\]</span></span></p>
<p>现在可以证明（参见习题 3）：</p>
<p><span id="eq-13_2_3"><span class="math display">\[
E[\sqrt{Y}] = \frac{\sqrt{2}\Gamma(n/2)}{\Gamma(\frac{n-1}{2})}, \quad \text{当} \, Y \sim \chi^2_{n-1}
\tag{13.3}\]</span></span></p>
<p>由于</p>
<p><span class="math display">\[
E\left[\sqrt{(n-1)S^2/\sigma^2}\right] = \sqrt{n-1}E[S_1]/\sigma
\]</span></p>
<p>根据 <a href="#eq-13_2_2" class="quarto-xref">式&nbsp;<span>13.2</span></a> 和 <a href="#eq-13_2_3" class="quarto-xref">式&nbsp;<span>13.3</span></a>，我们可以得出：</p>
<p><span class="math display">\[
E[S_1] = \frac{\sqrt{2}\Gamma(n/2)\sigma}{\sqrt{n-1}\Gamma(\frac{n-1}{2})}
\]</span></p>
<p>因此，如果定义</p>
<p><span class="math display">\[
c(n) = \frac{\sqrt{2}\Gamma(n/2)}{\sqrt{n-1}\Gamma(\frac{n-1}{2})}
\]</span></p>
<p>则根据 <a href="#eq-13_2_1" class="quarto-xref">式&nbsp;<span>13.1</span></a>，可以推导出 <span class="math inline">\(\overline{S}/c(n)\)</span> 是 <span class="math inline">\(\sigma\)</span> 的无偏估计量。</p>
<p><a href="#tbl-13_1" class="quarto-xref">表&nbsp;<span>13.1</span></a> 展示了从 <span class="math inline">\(n=2\)</span> 到 <span class="math inline">\(n=10\)</span> 的 <span class="math inline">\(c(n)\)</span> 的值。</p>
<div id="tbl-13_1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-13_1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
表&nbsp;13.1: <span class="math inline">\(c(n)\)</span> 的值
</figcaption>
<div aria-describedby="tbl-13_1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<tbody>
<tr class="odd">
<td>c(2)</td>
<td>0.7978849</td>
</tr>
<tr class="even">
<td>c(3)</td>
<td>0.8862266</td>
</tr>
<tr class="odd">
<td>c(4)</td>
<td>0.9213181</td>
</tr>
<tr class="even">
<td>c(5)</td>
<td>0.9399851</td>
</tr>
<tr class="odd">
<td>c(6)</td>
<td>0.9515332</td>
</tr>
<tr class="even">
<td>c(7)</td>
<td>0.9593684</td>
</tr>
<tr class="odd">
<td>c(8)</td>
<td>0.9650309</td>
</tr>
<tr class="even">
<td>c(9)</td>
<td>0.9693103</td>
</tr>
<tr class="odd">
<td>c(10)</td>
<td>0.9726596</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="技术说明">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
技术说明
</div>
</div>
<div class="callout-body-container callout-body">
<p>在计算 <a href="#tbl-13_1" class="quarto-xref">表&nbsp;<span>13.1</span></a> 中的数值时，<span class="math inline">\(\Gamma(n/2)\)</span> 和 <span class="math inline">\(\Gamma\left(n - \frac{1}{2}\right)\)</span> 的计算基于我们在 <span class="quarto-unresolved-ref">?sec-5_7</span> 中已经构建的递归公式：</p>
<p><span class="math display">\[
\Gamma(a) = (a - 1)\Gamma(a - 1)
\]</span></p>
<p>递归公式表明，对于整数 <span class="math inline">\(n\)</span>，有：</p>
<p><span class="math display">\[
\begin{aligned}
\Gamma(n) &amp;= (n - 1)(n - 2) \cdots 3 \cdot 2 \cdot 1 \cdot \Gamma(1) \\
&amp;= (n - 1)! \quad \because \quad \Gamma(1) = \int_{0}^{\infty} e^{-x} \, dx = 1
\end{aligned}
\]</span></p>
<p>类似的，我们可得到如下的递归公式：</p>
<p><span class="math display">\[
\Gamma\left(\frac{n + 1}{2}\right) = \left(\frac{n - 1}{2}\right)\left(\frac{n - 3}{2}\right)\cdots\frac{3}{2} \cdot \frac{1}{2} \cdot \Gamma\left(\frac{1}{2}\right)
\]</span></p>
<p><span class="math display">\[
\begin{aligned}
\Gamma\left(\frac{1}{2}\right) &amp;= \int_{0}^{\infty} e^{-x} x^{-1/2} \, dx \\
&amp;= \int_{0}^{\infty} e^{-y^2/2} \frac{\sqrt{2}}{y} \, y \, dy \quad \text{by } x = \frac{y^2}{2}, \, dx = y \, dy \\
&amp;= \sqrt{2} \int_{0}^{\infty} e^{-y^2/2} \, dy \\
&amp;= 2\sqrt{\pi} \cdot \frac{1}{\sqrt{2\pi}} \int_{0}^{\infty} e^{-y^2/2} \, dy \\
&amp;= 2\sqrt{\pi} \cdot P[N(0, 1) &gt; 0] \\
&amp;= \sqrt{\pi}
\end{aligned}
\]</span></p>
</div>
</div>
<p>本节所述的对 <span class="math inline">\(\mu\)</span> 和 <span class="math inline">\(\sigma\)</span> 的估计用到了所有的 <span class="math inline">\(k\)</span> 个子组，因此，只有当整个 <strong>过程</strong> 都处于受控状态时才是合理的。为了检验这一点，我们基于 <span class="math inline">\(\mu\)</span> 和 <span class="math inline">\(\sigma\)</span> 的估计值来计算 <strong>控制限</strong>（<em>the control limits</em>），即：</p>
<p><span id="eq-13_2_4"><span class="math display">\[
\begin{aligned}
\text{LCL} &amp; = \overline{\overline{X}}-\frac{3\overline{S}}{c(n)\sqrt{n}} \\
\text{UCL} &amp; = \overline{\overline{X}}+\frac{3\overline{S}}{c(n)\sqrt{n}}
\end{aligned}
\tag{13.4}\]</span></span></p>
<p>接下来，我们检查每个子组的平均值 <span class="math inline">\(\overline{X}_i\)</span> 是否落在上下控制限之间。我们删除那些平均值未落在控制限内的子组（假设 <strong>过程</strong> 暂时失控），然后重新计算 <span class="math inline">\(\mu\)</span> 和 <span class="math inline">\(\sigma\)</span> 的估计值。然后，我们再次检查所有剩余子组的平均值是否都位于控制限之间。如果还存在子组的的平均值未落在控制限内，删除这些子组，如此反复。当然，如果有过多的子组平均值落在控制限之外，就表明 <strong>过程</strong> 尚未处于受控状态。</p>
<div id="exr-13_2_b" class="theorem exercise">
<p><span class="theorem-title"><strong>习题 13.2</strong></span> 对于 <a href="#exr-13_2_a" class="quarto-xref">习题&nbsp;<span>13.1</span></a> 而言，假设该 <strong>过程</strong> 刚刚开始，因此均值 <span class="math inline">\(\mu\)</span> 和标准差 <span class="math inline">\(\sigma\)</span> 是未知的。在这种场景下，我们重新来考虑下 <a href="#exr-13_2_a" class="quarto-xref">习题&nbsp;<span>13.1</span></a>。此时，假设样本标准差如下所示：</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th><span class="math inline">\(\overline{X}\)</span></th>
<th><span class="math inline">\(S\)</span></th>
<th></th>
<th><span class="math inline">\(\overline{X}\)</span></th>
<th><span class="math inline">\(S\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>3.01</td>
<td>0.12</td>
<td>6</td>
<td>3.02</td>
<td>0.08</td>
</tr>
<tr class="even">
<td>2</td>
<td>2.97</td>
<td>0.14</td>
<td>7</td>
<td>3.10</td>
<td>0.15</td>
</tr>
<tr class="odd">
<td>3</td>
<td>3.12</td>
<td>0.08</td>
<td>8</td>
<td>3.14</td>
<td>0.16</td>
</tr>
<tr class="even">
<td>4</td>
<td>2.99</td>
<td>0.11</td>
<td>9</td>
<td>3.09</td>
<td>0.13</td>
</tr>
<tr class="odd">
<td>5</td>
<td>3.03</td>
<td>0.09</td>
<td>10</td>
<td>3.20</td>
<td>0.16</td>
</tr>
</tbody>
</table>
<p>因为 <span class="math inline">\(\overline{\overline{X}} = 3.067\)</span>，<span class="math inline">\(\overline{S} = 0.122\)</span>，<span class="math inline">\(c(4) = 0.9213\)</span>，控制限为：</p>
<p><span class="math inline">\(\text{LCL} = 3.067 - \frac{3 \times 0.122}{2 \times 0.9213} = 2.868\)</span> <span class="math inline">\(\text{UCL} = 3.067 + \frac{3 \times 0.122}{2 \times 0.9213} = 3.266\)</span></p>
<p>由于所有的 <span class="math inline">\(\overline{X}_i\)</span> 均落在控制限内，因此我们假设该 <strong>过程</strong> 处于控制状态，且均值为 <span class="math inline">\(\mu = 3.067\)</span>，标准差为：<span class="math inline">\(\sigma = \frac{\overline{S}}{c(4)} = 0.1324\)</span>。</p>
<p>假设该生产线生产的产品的规格应该为 <span class="math inline">\(3 \pm 0.1\)</span>。假设该 <strong>过程</strong> 保持处于受控状态，且上述数据是对真实均值和标准差的准确估计，计算满足规格的产品的比例？</p>
</div>
<div id="sol-13_2_b" class="proof solution">
<p><span class="proof-title"><em>解 13.2</em>. </span>在 <span class="math inline">\(\mu = 3.067\)</span>，<span class="math inline">\(\sigma = 0.1324\)</span> 下，我们有：</p>
<p><span class="math display">\[
\begin{align}
P\{2.9 \leq X \leq 3.1\} &amp;= P\left\{ \frac{2.9 - 3.067}{0.1324} \leq \frac{X - 3.067}{0.1324} \leq \frac{3.1 - 3.067}{0.1324} \right\} \\
&amp;= \Phi(0.2492) - \Phi(-1.2613) \\
&amp;= 0.5984 - 0.1036 \\
&amp;= 0.4948
\end{align}
\]</span></p>
<p>因此，满足规格要求的产品比例为 49%。<span class="math inline">\(\blacksquare\)</span></p>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="备注">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
备注
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>1.</strong></p>
<p>估计量 <span class="math inline">\(\overline{\overline{X}}\)</span> 等于所有 <span class="math inline">\(nk\)</span> 个测量值的平均值，因此，显然，<span class="math inline">\(\overline{\overline{X}}\)</span> 是 <span class="math inline">\(\mu\)</span> 的估计量。然而，为什么不直接使用所有 <span class="math inline">\(nk\)</span> 个测量值的样本标准差（如下式所示）作为 <span class="math inline">\(\sigma\)</span> 的初始估计量可能并不直观：</p>
<p><span class="math inline">\(S \equiv \sqrt{\frac{\sum_{i=1}^{nk} \left( X_i - \overline{\overline{X}} \right)^2}{nk - 1}}\)</span></p>
<p>主要的原因在于：<strong>过程</strong> 在前 <span class="math inline">\(k\)</span> 个子组期间可能并非始终处于受控状态，因此如上式所示的估计量可能与真实值之间相差甚远。此外，一个 <strong>过程</strong> 可能会由于某些突发事件而失控，从而导致均值 <span class="math inline">\(\mu\)</span> 发生变化，而标准差却保持不变。在这种情况下，各子组的样本标准差仍然可以作为 <span class="math inline">\(\sigma\)</span> 的估计量，而 <span class="math inline">\(S\)</span> 却不能。</p>
<p>即使整个 <strong>过程</strong> 看似均处于受控状态，<span class="math inline">\(\sigma\)</span> 的无偏估计量 <span class="math inline">\(\frac{\overline{S}}{c(n)}\)</span> 仍然要优于样本标准差 <span class="math inline">\(S\)</span>。这是因为：我们不能确定在此期间均值终没有发生变化。例如，即使所有子组均值都落在控制限内，我们判断该 <strong>过程</strong> 处于受控状态，但这并不能保证不存在某些特定原因导致的差异（这些特定原因导致的差异可能导致均值发生变化，但这些变化尚未在图表中体现出来）。这意味着在实际操作中，即使假设 <strong>过程</strong> 处于受控状态并持续生产产品，我们也需要认识到可能会存在某些特定原因导致的差异。由此认为，<span class="math inline">\(\frac{\overline{S}}{c(n)}\)</span> 是一个比样本标准差更“安全”的估计量。换句话说，当 <strong>过程</strong> 始终受控时，<span class="math inline">\(\frac{\overline{S}}{c(n)}\)</span> 的表现可能不如样本标准差好；但如果均值存在些微小变化，<span class="math inline">\(\frac{\overline{S}}{c(n)}\)</span> 的表现会比样本标准差要好很多。</p>
<p><strong>2.</strong></p>
<p>以前，我们常使用基于子组极差（<em>subgroup ranges</em>）——即子组中最大值与最小值之差来作为 <span class="math inline">\(\sigma\)</span> 的估计量。这种方法的目的主要是简化必要的计算量（显然，计算极差比计算子组的样本标准差要容易得多）。然而，随着现代计算机能力的增强，计算量已经不再是一个需要考虑的限制因素。此外，标准差估计量的方差比极差估计量的方差更小，并且鲁棒性也更好（即使背后的数据分布不是正态分布，标准差估计量仍能提供合理的总体标准差估计）。因此，在本书中，我们不考虑极差估计量。</p>
</div>
</div>
</section>
</section>
<section id="sec-13_3" class="level2" data-number="13.3">
<h2 data-number="13.3" class="anchored" data-anchor-id="sec-13_3"><span class="header-section-number">13.3</span> <span class="math inline">\(\text{S}\)</span>-控制图</h2>
<p><a href="#sec-13_2" class="quarto-xref"><span>小节 13.2</span></a> 中介绍的基于 <span class="math inline">\(\overline{X}\)</span> 的控制图主要用于检测总体均值的变化。但有时候，我们也需要关注总体方差可能发生变化的情况下，此时可以使用 <span class="math inline">\(\text{S}\)</span>-控制图。</p>
<p>假设 <strong>过程</strong> 在受控状态下所生产的产品具有可测量的特性，这些特性服从均值为 <span class="math inline">\(\mu\)</span>、方差为 <span class="math inline">\(\sigma^2\)</span> 的正态分布。若 <span class="math inline">\(S_i\)</span> 是第 <span class="math inline">\(i\)</span> 个子组的样本标准差，则：</p>
<p><span class="math inline">\(S_i = \sqrt{\frac{\sum_{j=1}^n \left( X_{(i-1)n+j} - \overline{X}_i \right)^2}{n-1}}\)</span></p>
<p>如 <a href="#sec-13_2_1" class="quarto-xref"><span>小节 13.2.1</span></a> 所述：</p>
<p><span id="eq-13_3_1"><span class="math display">\[
E[S_i] = c(n)\sigma
\tag{13.5}\]</span></span></p>
<p>此外，<span class="math inline">\(S_i\)</span> 的方差为：</p>
<p><span id="eq-13_3_2"><span class="math display">\[
\begin{align}
\text{Var}(S_i) &amp;= E[S_i^2] - \left(E[S_i]\right)^2 \\
&amp;= \sigma^2 - c^2(n)\sigma^2 \\
&amp;= \sigma^2[1 - c^2(n)]
\end{align}
\tag{13.6}\]</span></span></p>
<p>当 <strong>过程</strong> 处于受控状态时，<span class="math inline">\(S_i\)</span> 服从一个常数（<span class="math inline">\(\sigma / \sqrt{n-1}\)</span>）乘以一个自由度为 <span class="math inline">\(n-1\)</span> 的卡方随机变量的平方根（<span class="math inline">\(\sqrt{\chi^2_{n-1}}\)</span>）的分布（<span class="math inline">\(\frac{\sigma}{\sqrt{n-1}}\sqrt{\chi^2_{n-1}}\)</span>）。</p>
<p>可以证明，<span class="math inline">\(S_i\)</span> 落在其均值 3 个标准差范围内的概率接近于 1，即：</p>
<p><span class="math inline">\(P\{E[S_i] - 3\sqrt{\text{Var}(S_i)} &lt; S_i &lt; E[S_i] + 3\sqrt{\text{Var}(S_i)}\} \approx 0.99\)</span></p>
<p>因此，利用 <a href="#eq-13_3_1" class="quarto-xref">式&nbsp;<span>13.5</span></a> 和 <a href="#eq-13_3_2" class="quarto-xref">式&nbsp;<span>13.6</span></a> 中的 <span class="math inline">\(E[S_i]\)</span> 和 <span class="math inline">\(\text{Var}(S_i)\)</span>，<span class="math inline">\(\text{S}\)</span>-控制图的上、下控制限可以设置为：</p>
<p><span id="eq-13_3_3"><span class="math display">\[
\begin{align}
\text{UCL} &amp;= \sigma \left[c(n) + 3\sqrt{1 - c^2(n)}\right] \\
\text{LCL} &amp;= \sigma \left[c(n) - 3\sqrt{1 - c^2(n)}\right]
\end{align}
\tag{13.7}\]</span></span></p>
<p>在图中连续绘制 <span class="math inline">\(S_i\)</span>，以确认 <span class="math inline">\(S_i\)</span> 是否落在上、下控制限之内。当某个 <span class="math inline">\(S_i\)</span> 落在控制限之外时，应该停止 <strong>过程</strong>，并认为该 <strong>过程</strong> 已经处于失控状态。</p>
<p>当我们从起始阶段开始绘制控制图时，<span class="math inline">\(\sigma\)</span> 还是未知的，此时可以使用 <span class="math inline">\(\overline{S}/c(n)\)</span> 来估计 <span class="math inline">\(\sigma\)</span>。基于 <a href="#eq-13_3_3" class="quarto-xref">式&nbsp;<span>13.7</span></a>，估计的控制限为：</p>
<p><span id="eq-13_3_4"><span class="math display">\[
\begin{align}
\text{UCL} &amp;= \overline{S} \left[1 + 3\sqrt{\frac{1 - c^2(n)}{c^2(n)}}\right] \\
\text{LCL} &amp;= \overline{S} \left[1 - 3\sqrt{\frac{1 - c^2(n)}{c^2(n)}}\right]
\end{align}
\tag{13.8}\]</span></span></p>
<p>就像在刚开始绘制 <span class="math inline">\(\overline{X}\)</span> 控制图时那样，在绘制 <span class="math inline">\(\text{S}\)</span>-控制图时，也应检查 <span class="math inline">\(k\)</span> 个子组的样本标准差 <span class="math inline">\(S_1, S_2, \dots, S_k\)</span> 是否都落在控制限内。如果任何一个子组的 <span class="math inline">\(S_i\)</span> 落在控制限之外，则应舍弃这些子组并重新计算 <span class="math inline">\(\overline{S}\)</span>。</p>
<div id="exm-13_3_a" class="theorem example">
<p><span class="theorem-title"><strong>例 13.1</strong></span> 一个新启动的 <strong>过程</strong> 的 20 个子组（每组大小为 5）的 <span class="math inline">\(\overline{X}\)</span> 和 <span class="math inline">\(S\)</span> 值 如下表所示。</p>
<table class="caption-top table">
<colgroup>
<col style="width: 7%">
<col style="width: 12%">
<col style="width: 5%">
<col style="width: 7%">
<col style="width: 12%">
<col style="width: 5%">
<col style="width: 7%">
<col style="width: 12%">
<col style="width: 5%">
<col style="width: 7%">
<col style="width: 12%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th>Sub-group</th>
<th><span class="math inline">\(\overline{X}\)</span></th>
<th><span class="math inline">\(S\)</span></th>
<th>Sub-group</th>
<th><span class="math inline">\(\overline{X}\)</span></th>
<th><span class="math inline">\(S\)</span></th>
<th>Sub-group</th>
<th><span class="math inline">\(\overline{X}\)</span></th>
<th><span class="math inline">\(S\)</span></th>
<th>Sub-group</th>
<th><span class="math inline">\(\overline{X}\)</span></th>
<th><span class="math inline">\(S\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>35.1</td>
<td>4.2</td>
<td>6</td>
<td>36.4</td>
<td>4.5</td>
<td>11</td>
<td>38.1</td>
<td>4.2</td>
<td>16</td>
<td>41.3</td>
<td>8.2</td>
</tr>
<tr class="even">
<td>2</td>
<td>33.2</td>
<td>4.4</td>
<td>7</td>
<td>35.9</td>
<td>3.4</td>
<td>12</td>
<td>37.6</td>
<td>3.9</td>
<td>17</td>
<td>35.7</td>
<td>8.1</td>
</tr>
<tr class="odd">
<td>3</td>
<td>31.7</td>
<td>2.5</td>
<td>8</td>
<td>38.4</td>
<td>5.1</td>
<td>13</td>
<td>38.8</td>
<td>3.2</td>
<td>18</td>
<td>36.3</td>
<td>4.2</td>
</tr>
<tr class="even">
<td>4</td>
<td>35.4</td>
<td>3.2</td>
<td>9</td>
<td>35.7</td>
<td>3.8</td>
<td>14</td>
<td>34.3</td>
<td>4.0</td>
<td>19</td>
<td>35.4</td>
<td>4.1</td>
</tr>
<tr class="odd">
<td>5</td>
<td>34.5</td>
<td>2.6</td>
<td>10</td>
<td>27.2</td>
<td>6.2</td>
<td>15</td>
<td>43.2</td>
<td>3.5</td>
<td>20</td>
<td>34.6</td>
<td>3.7</td>
</tr>
</tbody>
</table>
<p>由于 <span class="math inline">\(\overline{\overline{X}} = 35.94\)</span>，<span class="math inline">\(\overline{S} = 4.35\)</span>，<span class="math inline">\(c(5) = 0.9400\)</span>，根据 <a href="#eq-13_2_4" class="quarto-xref">式&nbsp;<span>13.4</span></a> 和 <a href="#eq-13_3_4" class="quarto-xref">式&nbsp;<span>13.8</span></a> 可以得出 <span class="math inline">\(\overline{X}\)</span> 和 <span class="math inline">\(S\)</span> 的初始上下控制限为：</p>
<p><span class="math inline">\(\text{UCL}(\overline{X}) = 42.149\)</span> <span class="math inline">\(\text{LCL}(\overline{X}) = 29.731\)</span> <span class="math inline">\(\text{UCL}(S) = 9.087\)</span> <span class="math inline">\(\text{LCL}(S) = -0.386\)</span></p>
<p>根据上述控制限绘制的 <span class="math inline">\(S\)</span> 控制图和 <span class="math inline">\(\overline{X}\)</span> 控制图分别如 <a href="#fig-13_2" class="quarto-xref">图&nbsp;<span>13.2</span></a> (a) 和 <a href="#fig-13_2" class="quarto-xref">图&nbsp;<span>13.2</span></a> (b)。由于 <span class="math inline">\(\overline{X}_{10}\)</span> 和 <span class="math inline">\(\overline{X}_{15}\)</span> 超出了 <span class="math inline">\(\overline{X}\)</span> 的控制限，必须剔除这些子组，并重新计算控制限（我们将必要的计算留作练习）。</p>
<details class="code-fold">
<summary>代码</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># S control chart.</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">4.2</span>, <span class="fl">4.4</span>, <span class="fl">2.5</span>, <span class="fl">3.2</span>, <span class="fl">2.6</span>, <span class="fl">4.5</span>, <span class="fl">3.4</span>, <span class="fl">5.1</span>, <span class="fl">3.8</span>, <span class="fl">6.2</span>, <span class="fl">4.2</span>, <span class="fl">3.9</span>, </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>       <span class="fl">3.2</span>, <span class="fl">4.0</span>, <span class="fl">3.5</span>, <span class="fl">8.2</span>, <span class="fl">8.1</span>, <span class="fl">4.2</span>, <span class="fl">4.1</span>, <span class="fl">3.7</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fu">seq_along</span>(x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">i=</span>i, <span class="at">x=</span>x)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>UCL <span class="ot">&lt;-</span> <span class="fl">9.087</span>   <span class="co"># 上控制限</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>LCL <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.386</span>  <span class="co"># 下控制限</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> i, <span class="at">y =</span> x)) <span class="sc">+</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">4</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span>  <span class="co"># 绘制均值点</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> UCL, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># 上控制限</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> LCL, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># 下控制限</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">11</span>, <span class="at">y =</span> UCL, <span class="at">label =</span> <span class="st">"UCL"</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span>  <span class="co"># 标注UCL</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">11</span>, <span class="at">y =</span> LCL, <span class="at">label =</span> <span class="st">"LCL"</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">1.5</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span>  <span class="co"># 标注LCL</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"S Control Chart"</span>, <span class="at">x =</span> <span class="st">"Subgroup"</span>, <span class="at">y =</span> <span class="fu">expression</span>(S)) <span class="sc">+</span>  <span class="co"># 添加标题和轴标签</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">20</span>),</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">20</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()  <span class="co"># 使用简洁主题</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co"># \overline{X} control chart.</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">35.1</span>, <span class="fl">33.2</span>, <span class="fl">31.7</span>, <span class="fl">35.4</span>, <span class="fl">34.5</span>, </span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>       <span class="fl">36.4</span>, <span class="fl">35.9</span>, <span class="fl">38.4</span>, <span class="fl">35.7</span>, <span class="fl">27.2</span>, </span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>       <span class="fl">38.1</span>, <span class="fl">37.6</span>, <span class="fl">38.8</span>, <span class="fl">34.3</span>, <span class="fl">43.2</span>, </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>       <span class="fl">41.3</span>, <span class="fl">35.7</span>, <span class="fl">36.3</span>, <span class="fl">35.4</span>, <span class="fl">34.6</span>)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fu">seq_along</span>(x)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">i=</span>i, <span class="at">x=</span>x)</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>UCL <span class="ot">&lt;-</span> <span class="fl">42.149</span>   <span class="co"># 上控制限</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>LCL <span class="ot">&lt;-</span> <span class="fl">29.731</span>  <span class="co"># 下控制限</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> i, <span class="at">y =</span> x)) <span class="sc">+</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">4</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span>  <span class="co"># 绘制均值点</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> UCL, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># 上控制限</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> LCL, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># 下控制限</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">11</span>, <span class="at">y =</span> UCL, <span class="at">label =</span> <span class="st">"UCL"</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span>  <span class="co"># 标注UCL</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">11</span>, <span class="at">y =</span> LCL, <span class="at">label =</span> <span class="st">"LCL"</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">1.5</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span>  <span class="co"># 标注LCL</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"bar{X} Control Chart"</span>, <span class="at">x =</span> <span class="st">"Subgroup"</span>, <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">bar</span>(X))) <span class="sc">+</span>  <span class="co"># 添加标题和轴标签</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">20</span>),</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">20</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()  <span class="co"># 使用简洁主题</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-13_2" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-13_2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-13_2" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-13_2-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-13_2-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="13_files/figure-html/fig-13_2-1.png" class="img-fluid figure-img" data-ref-parent="fig-13_2" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-13_2-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) <span class="math inline">\(S\)</span>-控制图
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-13_2" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-13_2-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-13_2-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="13_files/figure-html/fig-13_2-2.png" class="img-fluid figure-img" data-ref-parent="fig-13_2" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-13_2-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) <span class="math inline">\(\overline{X}\)</span>-控制图
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-13_2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;13.2
</figcaption>
</figure>
</div>
<p><span class="math inline">\(\blacksquare\)</span></p>
</div>
</section>
<section id="sec-13_4" class="level2" data-number="13.4">
<h2 data-number="13.4" class="anchored" data-anchor-id="sec-13_4"><span class="header-section-number">13.4</span> 不合格品率控制图</h2>
<p>当测量的数据值是在某个范围内连续变化时，可以使用 <span class="math inline">\(\overline{X}\)</span>-控制图和 <span class="math inline">\(S\)</span>-控制图判断 <strong>过程</strong> 是否处于受控状态。但有时候，可直接将所生产的产品分类为有缺陷或无缺陷，此时，我们依然可以构建控制图。</p>
<p>假设当 <strong>过程</strong> 处于受控状态时，所生产的每个产品出现缺陷的概率相互独立且为 <span class="math inline">\(p\)</span>。令 <span class="math inline">\(X\)</span> 表示大小为 <span class="math inline">\(n\)</span> 的产品子组中缺陷产品的数量，那么在 <strong>过程</strong> 受控的假设下，<span class="math inline">\(X\)</span> 将是一个参数为 <span class="math inline">\((n, p)\)</span> 的二项随机分布。如果 <span class="math inline">\(F = X / n\)</span> 是子组缺陷产品的比例，那么在 <strong>过程</strong> 受控的假设下，其均值和标准差由以下公式给出：</p>
<p><span class="math inline">\(E[F]=\frac{E[X]}{n}=\frac{np}{n}=p\)</span></p>
<p><span class="math inline">\(\sqrt{\text{Var}(F)}=\sqrt{\frac{\text{Var}(X)}{n^2}}=\sqrt{\frac{np(1 - p)}{n^2}}=\sqrt{\frac{p(1 - p)}{n}}\)</span></p>
<p>因此，当 <strong>过程</strong> 处于受控状态时，大小为 <span class="math inline">\(n\)</span> 的子组中缺陷产品的比例很可能在以下范围内：</p>
<p><span class="math inline">\(\text{LCL}=p - 3\sqrt{\frac{p(1 - p)}{n}}, \quad \text{UCL}=p + 3\sqrt{\frac{p(1 - p)}{n}}\)</span></p>
<p>对于本节的场景，子组大小 <span class="math inline">\(n\)</span> 通常比 <span class="math inline">\(\overline{X}\)</span>-控制图和 <span class="math inline">\(S\)</span>-控制图中使用的 4~10 的典型值要大得多。选择更大的 <span class="math inline">\(n\)</span> 的主要原因在于：如果 <span class="math inline">\(p\)</span> 很小且 <span class="math inline">\(n\)</span> 的大小不合理，那么即使 <strong>过程</strong> 失控，大多数子组也将没有缺陷产品。因此，与 <span class="math inline">\(np\)</span> 不接近于零的 <span class="math inline">\(n\)</span> 相比，<span class="math inline">\(np\)</span> 接近于零的 <span class="math inline">\(n\)</span> 在检测质量变化时需要花费更长的时间。</p>
<p>当然，要启动这样一个控制图，我们首先必须要估计 <span class="math inline">\(p\)</span>。为此，选择 <span class="math inline">\(k\)</span> 个子组，并尽量使 <span class="math inline">\(k\geq20\)</span>，同时令 <span class="math inline">\(F_i\)</span> 表示第 <span class="math inline">\(i\)</span> 个子组中缺陷产品的比例。<span class="math inline">\(p\)</span> 的估计值由 <span class="math inline">\(\overline{F}\)</span> 给出，其定义为：</p>
<p><span class="math inline">\(\overline{F}=\frac{F_1+\cdots + F_k}{k}\)</span></p>
<p>由于 <span class="math inline">\(nF_i\)</span> 等于第 <span class="math inline">\(i\)</span> 个子组中的缺陷产品数量，则 <span class="math inline">\(\overline{F}\)</span> 也可以表示为：</p>
<p><span class="math display">\[
\begin{align*}
\overline{F}&amp;=\frac{nF_1+\cdots + nF_k}{nk}\\
&amp;=\frac{\text{所有子组中的缺陷产品总数}}{\text{所有子组中的产品总数}}
\end{align*}
\]</span></p>
<p>换句话说，<span class="math inline">\(p\)</span> 的估计值就是所检查产品中缺陷产品的比例。此时上控制限和下控制限由以下公式给出：</p>
<p><span class="math inline">\(\text{LCL}=\overline{F}-3\sqrt{\frac{\overline{F}(1 - \overline{F})}{n}}, \quad \text{UCL}=\overline{F}+3\sqrt{\frac{\overline{F}(1 - \overline{F})}{n}}\)</span></p>
<p>现在，我们就可以检查子组的缺陷比例 <span class="math inline">\(F_1,F_2,\cdots,F_k\)</span> 是否落在如上的控制限内。如果某些子组超出了控制限范围，那么应该剔除相应的子组，并重新计算 <span class="math inline">\(\overline{F}\)</span>。</p>
<div id="exm-13_4_a" class="theorem example">
<p><span class="theorem-title"><strong>例 13.2</strong></span> 对于一台自动螺丝机生产线而言，我们从每小时生产的产品中连续抽取 50 个螺丝作为样本，每个螺丝或者为合格品或者为缺陷品。对 20 个这样的样本进行检测，得到以下数据。</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>子组</th>
<th>缺陷产品个数</th>
<th>F</th>
<th>子组</th>
<th>缺陷产品个数</th>
<th>F</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>6</td>
<td>.12</td>
<td>11</td>
<td>1</td>
<td>.02</td>
</tr>
<tr class="even">
<td>2</td>
<td>5</td>
<td>.10</td>
<td>12</td>
<td>3</td>
<td>.06</td>
</tr>
<tr class="odd">
<td>3</td>
<td>3</td>
<td>.06</td>
<td>13</td>
<td>2</td>
<td>.04</td>
</tr>
<tr class="even">
<td>4</td>
<td>0</td>
<td>.00</td>
<td>14</td>
<td>0</td>
<td>.00</td>
</tr>
<tr class="odd">
<td>5</td>
<td>1</td>
<td>.02</td>
<td>15</td>
<td>1</td>
<td>.02</td>
</tr>
<tr class="even">
<td>6</td>
<td>2</td>
<td>.04</td>
<td>16</td>
<td>1</td>
<td>.02</td>
</tr>
<tr class="odd">
<td>7</td>
<td>1</td>
<td>.02</td>
<td>17</td>
<td>0</td>
<td>.00</td>
</tr>
<tr class="even">
<td>8</td>
<td>0</td>
<td>.00</td>
<td>18</td>
<td>2</td>
<td>.04</td>
</tr>
<tr class="odd">
<td>9</td>
<td>2</td>
<td>.04</td>
<td>19</td>
<td>1</td>
<td>.02</td>
</tr>
<tr class="even">
<td>10</td>
<td>1</td>
<td>.02</td>
<td>20</td>
<td>2</td>
<td>.04</td>
</tr>
</tbody>
</table>
<p><span class="math inline">\(\overline{F} = \frac{缺陷产品总数}{产品总数} = \frac{34}{1000} = 0.034\)</span></p>
<p>因此，</p>
<p><span class="math display">\[
\begin{align*}
\text{UCL}&amp;= 0.034 + 3\sqrt{\frac{(0.034)(0.968)}{50}}= 0.1109\\
\text{LCL}&amp;= 0.034 - 3\sqrt{\frac{(0.034)(0.966)}{50}}=- 0.0429
\end{align*}
\]</span></p>
<p>由于第一个子组中的缺陷产品比例超出了上控制限，我们需要剔除该子组并重新计算 <span class="math inline">\(\overline{F}\)</span>：</p>
<p><span class="math inline">\(\overline{F}=\frac{34 - 6}{950}=0.0295\)</span></p>
<p>因此，新的上控制限和下控制限为 <span class="math inline">\(0.0295\pm\sqrt{(0.0295)(1 - 0.0295)/50}\)</span>，即</p>
<p><span class="math inline">\(\text{LCL}=-0.0423, \quad \text{UCL}=0.1013\)</span></p>
<p>由于其余子组的缺陷品比例都落在控制限内，我们可以接受这样的结论：当 <strong>过程</strong> 受控时，子组中的缺陷品比例应低于 <span class="math inline">\(0.1013\)</span>。<span class="math inline">\(\blacksquare\)</span></p>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="备注">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
备注
</div>
</div>
<div class="callout-body-container callout-body">
<p>请注意，即使质量变化可能会意味着质量提升，我们也试图检测到任何质量上的变化。也就是说，即使次品出现的概率降低，我们也将该过程视为“失控”。这样做的原因是，注意到质量上的任何变化（无论是变好还是变差）都很重要，以便能够评估变化的原因。换句话说，如果产品质量出现了提升，那么分析生产过程以确定质量提升的原因就很重要。（也就是说，我们做对了哪些事情？）</p>
</div>
</div>
</section>
<section id="sec-13_5" class="level2" data-number="13.5">
<h2 data-number="13.5" class="anchored" data-anchor-id="sec-13_5"><span class="header-section-number">13.5</span> 缺陷数控制图</h2>
<p>在本节中，我们将考虑由一个或一组产品构成的产品单元中的缺陷产品数量的场景，例如：飞机机翼中有缺陷的铆钉数量，某芯片公司每天生产的有缺陷的计算机芯片数量。本节分析的场景中，通常待检测的产品的数量比较大，并且实际出现缺陷的概率都很小，所以假设由此产生的缺陷数量服从泊松分布是合理的。因此，我们假设，当 <strong>过程</strong> 处于受控状态时，单位缺陷数量（<em>number of defects per unit</em>）服从均值为 <span class="math inline">\(\lambda\)</span> 的泊松分布。</p>
<p>如果我们令 <span class="math inline">\(X_i\)</span> 表示第 <span class="math inline">\(i\)</span> 个单元中的缺陷数量，那么，由于泊松随机变量的方差等于其均值，当 <strong>过程</strong> 处于受控状态时：</p>
<p><span class="math inline">\(E[X_i]=\lambda, \quad \text{Var}(X_i)=\lambda\)</span></p>
<p>因此，当 <strong>过程</strong> 处于受控状态时，<span class="math inline">\(X_i\)</span> 很可能在 <span class="math inline">\(\lambda\pm3\sqrt{\lambda}\)</span> 范围内，所以上控制限和下控制限由以下公式给出：</p>
<p><span class="math inline">\(\text{UCL}=\lambda + 3\sqrt{\lambda}, \quad \text{LCL}=\lambda - 3\sqrt{\lambda}\)</span></p>
<p>如前所述，当一开始绘制控制图、且 <span class="math inline">\(\lambda\)</span> 未知时，应该使用 <span class="math inline">\(k\)</span> 个单元的样本来估计 <span class="math inline">\(\lambda\)</span>：</p>
<p><span class="math inline">\(\overline{X}=(X_1+\cdots + X_k)/k\)</span></p>
<p>由此我们得到控制限：</p>
<p><span class="math inline">\(\overline{X}+3\sqrt{\overline{X}} \quad, \quad \overline{X}-3\sqrt{\overline{X}}\)</span></p>
<p>如果所有的 <span class="math inline">\(X_i\)</span>（<span class="math inline">\(i = 1,\cdots,k\)</span>）都落在控制限内，那么我们就假设 <strong>过程</strong> 处于受控状态，且 <span class="math inline">\(\lambda = \overline{X}\)</span>。如果存在 <span class="math inline">\(X_i\)</span> 超出控制限，那么就剔除这些数据并重新计算 <span class="math inline">\(\overline{X}\)</span>，依此类推。</p>
<p>在每个产品（或每天）的平均缺陷数较小的情况下，应该将产品（天数）组合起来，并使用给定数量——比如 <span class="math inline">\(n\)</span> 个产品（或 <span class="math inline">\(n\)</span> 天）——的缺陷数作为样本数据。由于独立泊松随机变量的和仍然是均值为 <span class="math inline">\(\lambda\)</span> 的泊松随机变量，因此给定数量的缺陷数据将是一个均值更大的 <span class="math inline">\(\lambda\)</span> 的泊松随机变量。所以，当每个产品的平均缺陷数小于 25 时，这种产品组合的方式是有用的。</p>
<p>为了体会产品组合的优势，假设当 <strong>过程</strong> 处于受控状态时，每个产品的平均缺陷数为 4，并且假设发生了一些情况，导致这个值从 4 变为 6，也就是说，产品缺陷数增加了 1 个标准差。那么，当连续数据由 <span class="math inline">\(n\)</span> 个产品中的缺陷数组成时，平均要生产多少个产品才能判断 <strong>过程</strong> 为失控状态。</p>
<p>由于在受控状态下，<span class="math inline">\(n\)</span> 个产品样本中的缺陷数服从均值和方差都等于 <span class="math inline">\(4n\)</span> 的泊松分布，所以控制限为 <span class="math inline">\(4n\pm3\sqrt{4n}\)</span> ，即 <span class="math inline">\(4n\pm6\sqrt{n}\)</span>。现在，如果每个产品的平均缺陷数变为 6，那么将服从均值为 <span class="math inline">\(6n\)</span> 的泊松分布，所以此时样本落在控制限之外的概率（称其为 <span class="math inline">\(p(n)\)</span>）由下式给出：</p>
<p><span class="math inline">\(p(n)=P\{Y &gt; 4n + 6\sqrt{n}\}+P\{Y &lt; 4n - 6\sqrt{n}\}\)</span></p>
<p>其中 <span class="math inline">\(Y\)</span> 服从均值为 <span class="math inline">\(6n\)</span> 的泊松分布。现在</p>
<p><span class="math display">\[
\begin{align*}
p(n) &amp;\approx P\{Y &gt; 4n + 6\sqrt{n}\} \\
&amp;=P\left\{\frac{Y - 6n}{\sqrt{6n}}&gt;\frac{6\sqrt{n}-2n}{\sqrt{6n}}\right\}\\
&amp;\approx P\left\{Z&gt;\frac{6\sqrt{n}-2n}{\sqrt{6n}}\right\}\quad \text{其中 }Z\sim \mathcal{N}(0,1)\\
&amp;=1 - \Phi\left(\sqrt{6}-2\sqrt{\frac{n}{6}}\right)
\end{align*}
\]</span></p>
<p>因为每个数据值落在控制限之外的概率为 <span class="math inline">\(p(n)\)</span>，所以得到一个落在控制限之外的数据值所需的产品数量是一个参数为 <span class="math inline">\(p(n)\)</span> 的几何随机变量，因此其均值为 <span class="math inline">\(1 / p(n)\)</span>。最后，由于每个数据值对应 <span class="math inline">\(n\)</span> 个产品，所以在 <strong>过程</strong> 被判定为失控之前生产的物品数量的均值为 <span class="math inline">\(n / p(n)\)</span>，所以失控时生产的产品平均数量为：</p>
<p><span class="math display">\[
n/(1 - \Phi(\sqrt{6}-\sqrt{\frac{2n}{3}}))
\]</span></p>
<p><a href="#tbl-13_2" class="quarto-xref">表&nbsp;<span>13.2</span></a> 中给出了不同的 <span class="math inline">\(n\)</span> 所对应的平均产品数量。由于当 <strong>过程</strong> 处于受控状态时，<span class="math inline">\(n\)</span> 的值越大越好（在 <strong>过程</strong> 被错误地判定为失控之前生产的产品的平均数量约为 <span class="math inline">\(n / 0.0027\)</span>），从 <a href="#tbl-13_2" class="quarto-xref">表&nbsp;<span>13.2</span></a> 中可以明显看出，我们应该至少组合 9 个产品。这意味着每个数据值（等于组合中的缺陷数量）的均值至少为 <span class="math inline">\(9\times4 = 36\)</span>。</p>
<div id="tbl-13_2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl quarto-uncaptioned" id="tbl-13_2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
表&nbsp;13.2
</figcaption>
<div aria-describedby="tbl-13_2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th><span class="math inline">\(n\)</span></th>
<th>平均产品数量</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>19.6</td>
</tr>
<tr class="even">
<td>2</td>
<td>20.66</td>
</tr>
<tr class="odd">
<td>3</td>
<td>19.80</td>
</tr>
<tr class="even">
<td>4</td>
<td>19.32</td>
</tr>
<tr class="odd">
<td>5</td>
<td>18.80</td>
</tr>
<tr class="even">
<td>6</td>
<td>18.18</td>
</tr>
<tr class="odd">
<td>7</td>
<td>18.13</td>
</tr>
<tr class="even">
<td>8</td>
<td>18.02</td>
</tr>
<tr class="odd">
<td>9</td>
<td>18</td>
</tr>
<tr class="even">
<td>10</td>
<td>18.18</td>
</tr>
<tr class="odd">
<td>11</td>
<td>18.33</td>
</tr>
<tr class="even">
<td>12</td>
<td>18.51</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<div id="exr-13_5_a" class="theorem exercise">
<p><span class="theorem-title"><strong>习题 13.3</strong></span> 对于某汽车厂商而言，以每 10 辆汽车为单元，连续单元发现的缺陷数量如下表所示：</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>汽车</th>
<th>缺陷量</th>
<th>汽车</th>
<th>缺陷量</th>
<th>汽车</th>
<th>缺陷量</th>
<th>汽车</th>
<th>缺陷量</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>141</td>
<td>6</td>
<td>74</td>
<td>11</td>
<td>63</td>
<td>16</td>
<td>68</td>
</tr>
<tr class="even">
<td>2</td>
<td>162</td>
<td>7</td>
<td>85</td>
<td>12</td>
<td>74</td>
<td>17</td>
<td>95</td>
</tr>
<tr class="odd">
<td>3</td>
<td>150</td>
<td>8</td>
<td>95</td>
<td>13</td>
<td>103</td>
<td>18</td>
<td>81</td>
</tr>
<tr class="even">
<td>4</td>
<td>111</td>
<td>9</td>
<td>76</td>
<td>14</td>
<td>81</td>
<td>19</td>
<td>102</td>
</tr>
<tr class="odd">
<td>5</td>
<td>92</td>
<td>10</td>
<td>68</td>
<td>15</td>
<td>94</td>
<td>20</td>
<td>73</td>
</tr>
</tbody>
</table>
<p>整个生产过程看起来是否一直处于受控状态？</p>
</div>
<div id="sol-13_5_a" class="proof solution">
<p><span class="proof-title"><em>解 13.3</em>. </span>因为 <span class="math inline">\(\overline{X}=94.4\)</span>，所以控制限为：</p>
<p><span class="math display">\[
\begin{align*}
\text{LCL}&amp;=94.4 - 3\sqrt{94.4}=65.25\\
\text{UCL}&amp;=94.4 + 3\sqrt{94.4}=123.55
\end{align*}
\]</span></p>
<p>由于前三个数据值大于上控制限（<em>UCL</em>），删除这三个数据并重新计算样本均值。由此可得：</p>
<p><span class="math inline">\(\overline{X}=\frac{(94.4)\times20-(141 + 162+150)}{17}=84.41\)</span></p>
<p>所以新的控制限为：</p>
<p><span class="math display">\[
\begin{align*}
\text{LCL}&amp;=84.41 - 3\sqrt{84.41}=56.85\\
\text{UCL}&amp;=84.41 + 3\sqrt{84.41}=111.97
\end{align*}
\]</span></p>
<p>此时，因为其余 17 个数据值都落在控制限内，我们可以宣称该 <strong>过程</strong> 现在处于受控状态，均值为 84.41。然而，由于在达到受控状态之前，缺陷的平均数量似乎一开始就很高，所以数据值 <span class="math inline">\(X_4\)</span> 也很可能是在 <strong>过程</strong> 处于受控状态之前产生的。因此，在这种情况下，需要删除 <span class="math inline">\(X_4\)</span> 并重新计算似乎是比较谨慎的做法。基于其余 16 个数据值，我们得到：</p>
<p><span class="math display">\[
\begin{align*}
\overline{X}&amp;=82.56\\
\text{LCL}&amp;=82.56 - 3\sqrt{82.56}=55.30\\
\text{UCL}&amp;=82.56 + 3\sqrt{82.56}=109.82
\end{align*}
\]</span></p>
<p>所以，该过程现在看起来处于受控状态，其均值为 82.56。 <span class="math inline">\(\blacksquare\)</span></p>
</div>
</section>
<section id="sec-13_6" class="level2" data-number="13.6">
<h2 data-number="13.6" class="anchored" data-anchor-id="sec-13_6"><span class="header-section-number">13.6</span> 用于检测总体均值变化的控制图</h2>
<p><a href="#sec-13_2" class="quarto-xref"><span>小节 13.2</span></a> 中给出的 <span class="math inline">\(\overline{X}\)</span>-控制图 的主要缺点在于对总体均值的微小变化不敏感。也就是说，当总体均值出现较小的变化时，由于图中的每个点仅依赖于单个子组，因此往往具有相对较大的方差，所以需要大量的数据点才能检测到总体均值出现的较小的变化。为了解决这个问题，可以让图中的每个数据点不仅取决于最近的子组均值，还取决于其他子组均值。目前，有三种方法可以实现该目的：</p>
<ol type="1">
<li>移动平均控制图（<em>moving averages</em>）</li>
<li>指数加权移动平均控制图（<em>exponentially weighted moving averages</em>）</li>
<li>累计和控制图（<em>cumulative sum</em>）</li>
</ol>
<section id="sec-13_6_1" class="level3" data-number="13.6.1">
<h3 data-number="13.6.1" class="anchored" data-anchor-id="sec-13_6_1"><span class="header-section-number">13.6.1</span> 移动平均控制图</h3>
<p>通过不断绘制最近 <span class="math inline">\(k\)</span> 个子组的平均值可以得到跨度为 <span class="math inline">\(k\)</span> 的移动平均控制图。也就是说，在 <span class="math inline">\(t\)</span> 时刻的移动平均值 <span class="math inline">\(M_t\)</span> 为：</p>
<p><span class="math inline">\(M_t=\frac{\overline{X}_t+\overline{X}_{t - 1}+\cdots+\overline{X}_{t - k + 1}}{k}\)</span></p>
<p>其中 <span class="math inline">\(\overline{X}_i\)</span> 是第 <span class="math inline">\(i\)</span> 个子组的平均值，并且：</p>
<p><span class="math inline">\(kM_t=\overline{X}_t+\overline{X}_{t - 1}+\cdots+\overline{X}_{t - k + 1}\)</span></p>
<p><span class="math inline">\(kM_{t + 1}=\overline{X}_{t + 1}+\overline{X}_t+\cdots+\overline{X}_{t - k + 2}\)</span></p>
<p>于是，<span class="math inline">\(kM_{t + 1}-kM_t\)</span> 得到：</p>
<p><span class="math inline">\(kM_{t + 1}-kM_t=\overline{X}_{t + 1}-\overline{X}_{t - k + 1}\)</span></p>
<p>即：</p>
<p><span class="math inline">\(M_{t + 1}=M_t+\frac{\overline{X}_{t + 1}-\overline{X}_{t - k + 1}}{k}\)</span></p>
<p>换句话说，<span class="math inline">\(t + 1\)</span> 时刻的移动平均值等于 <span class="math inline">\(t\)</span> 时刻的移动平均值加上 <span class="math inline">\(1/k\)</span> 乘以移动平均值中新添加的值（<span class="math inline">\(\overline{X}_{t + 1}\)</span>）与需要删除的值（<span class="math inline">\(\overline{X}_{t - k + 1}\)</span>）之间的差值。当 <span class="math inline">\(t\)</span> 小于 <span class="math inline">\(k\)</span> 时，<span class="math inline">\(M_t\)</span> 定义为前 <span class="math inline">\(t\)</span> 个子组的平均值，即：</p>
<p><span class="math inline">\(M_t=\frac{\overline{X}_1+\cdots+\overline{X}_t}{t} , \quad \text{如果} t &lt; k\)</span></p>
<p>假设当 <strong>过程</strong> 处于受控状态时，连续样本数据来自均值为 <span class="math inline">\(\mu\)</span>、方差为 <span class="math inline">\(\sigma^{2}\)</span> 的正态总体。因此，如果子组大小为 <span class="math inline">\(n\)</span>，那么 <span class="math inline">\(\overline{X}_{i}\)</span> 服从均值为 <span class="math inline">\(\mu\)</span>、方差为 <span class="math inline">\(\sigma^{2}/n\)</span> 的正态分布。由此可知，<span class="math inline">\(m\)</span> 个 <span class="math inline">\(\overline{X}_{i}\)</span> 的平均值将服从均值为 <span class="math inline">\(\mu\)</span>、方差为 <span class="math inline">\(\text{Var}(\overline{X}_{i})/m=\sigma^{2}/nm\)</span> 的正态分布。所以，当 <strong>过程</strong> 处于受控状态时：</p>
<p><span class="math display">\[
\begin{align}
E[M_{t}]&amp;=\mu \\
\text{Var}(M_{t}) &amp;=
\begin{cases}
\sigma^{2}/nt &amp; \text{如果 } t &lt; k \\
\sigma^{2}/nk &amp; \text{否则}
\end{cases}
\end{align}
\]</span></p>
<p>因为正态随机变量几乎总是位于其均值的 3 个标准差内，所以对于 <span class="math inline">\(M_{t}\)</span>，我们有以下上、下控制限：</p>
<p><span class="math display">\[
\begin{align}
\text{UCL} &amp;=
\begin{cases}
\mu + 3\sigma/\sqrt{nt} &amp; \text{如果 } t &lt; k \\
\mu + 3\sigma/\sqrt{nk} &amp; \text{否则}
\end{cases} \\
\text{LCL} &amp;=
\begin{cases}
\mu - 3\sigma/\sqrt{nt} &amp; \text{如果 } t &lt; k \\
\mu - 3\sigma/\sqrt{nk} &amp; \text{否则}
\end{cases}
\end{align}
\]</span></p>
<p>换句话说，除了前 <span class="math inline">\(k - 1\)</span> 个移动平均值之外，每当移动平均值与 <span class="math inline">\(\mu\)</span> 的差值超过 <span class="math inline">\(3\sigma/\sqrt{nk}\)</span> 时，就可以判定 <strong>过程</strong> 处于失控状态。</p>
<div id="exm-13_6_a" class="theorem example">
<p><span class="theorem-title"><strong>例 13.3</strong></span> 当某制造商的生产 <strong>过程</strong> 处于受控状态时，其所生产的产品的某测量值服从均值为 10、标准差为 2 的正态分布。以下的模拟数据表示来自均值为 11、标准差为 2 的正态总体的 25 个子组（每个子组大小为 5）的平均值。也就是说，这些数据表示 <strong>过程</strong> 失控后，其均值从 10 增加到 11 时的子组平均值。<a href="#tbl-13_3" class="quarto-xref">表&nbsp;<span>13.3</span></a> 给出了这 25 个子组的平均值，以及当 <span class="math inline">\(k = 8\)</span> 时的移动平均值和上下控制限。对于 <span class="math inline">\(t&gt;8\)</span>，下控制限和上控制限分别为 9.051318 和 10.94868。</p>
<div id="tbl-13_3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-13_3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
表&nbsp;13.3: * 表示过程失控
</figcaption>
<div aria-describedby="tbl-13_3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th><span class="math inline">\(t\)</span></th>
<th><span class="math inline">\(\overline{X}_t\)</span></th>
<th><span class="math inline">\(M_t\)</span></th>
<th><span class="math inline">\(LCL\)</span></th>
<th><span class="math inline">\(UCL\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>9.617728</td>
<td>9.617728</td>
<td>7.316719</td>
<td>12.68328</td>
</tr>
<tr class="even">
<td>2</td>
<td>10.25437</td>
<td>9.936049</td>
<td>8.102634</td>
<td>11.89737</td>
</tr>
<tr class="odd">
<td>3</td>
<td>9.876195</td>
<td>9.913098</td>
<td>8.450807</td>
<td>11.54919</td>
</tr>
<tr class="even">
<td>4</td>
<td>10.79338</td>
<td>10.13317</td>
<td>8.658359</td>
<td>11.34164</td>
</tr>
<tr class="odd">
<td>5</td>
<td>10.60699</td>
<td>10.22793</td>
<td>8.8</td>
<td>11.2</td>
</tr>
<tr class="even">
<td>6</td>
<td>10.48396</td>
<td>10.2706</td>
<td>8.904554</td>
<td>11.09545</td>
</tr>
<tr class="odd">
<td>7</td>
<td>13.33961</td>
<td>10.70903</td>
<td>8.95815</td>
<td>11.01419</td>
</tr>
<tr class="even">
<td>8</td>
<td>9.462969</td>
<td>10.55328</td>
<td>9.051318</td>
<td>10.94868</td>
</tr>
<tr class="odd">
<td>9</td>
<td>10.14556</td>
<td>10.61926</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>10</td>
<td>11.66342</td>
<td>10.79539</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>*11</td>
<td>11.55484</td>
<td>11.00634</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>*12</td>
<td>11.26203</td>
<td>11.06492</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>*13</td>
<td>12.31473</td>
<td>11.27839</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>*14</td>
<td>9.220009</td>
<td>11.1204</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>15</td>
<td>11.25206</td>
<td>10.85945</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>16</td>
<td>10.48662</td>
<td>10.98741</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>17</td>
<td>9.025091</td>
<td>10.84735</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>18</td>
<td>9.693386</td>
<td>10.6011</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>19</td>
<td>11.45989</td>
<td>10.58923</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>20</td>
<td>12.44213</td>
<td>10.73674</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>21</td>
<td>11.18981</td>
<td>10.59613</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>22</td>
<td>11.56674</td>
<td>10.88947</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>23</td>
<td>9.869849</td>
<td>10.71669</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>24</td>
<td>12.11311</td>
<td>10.92</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>*25</td>
<td>11.48656</td>
<td>11.22768</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>如表所示，第一个超出其控制限的移动平均值出现在 <span class="math inline">\(t=11\)</span>，其他类似情况出现在 12、13、14、16 和 25。有趣的是，通常的控制图——即 <span class="math inline">\(k = 1\)</span> 的移动平均值——会在 <span class="math inline">\(t=7\)</span> 时判定 <strong>过程</strong> 失控，因为 <span class="math inline">\(\overline{X}_{7}\)</span> 非常大。然而，这是该图唯一会表明 <strong>过程</strong> 失控的点（见 <a href="#fig-13_3" class="quarto-xref">图&nbsp;<span>13.3</span></a>）。</p>
<div class="cell">
<details class="code-fold">
<summary>代码</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">9.617728</span>, <span class="fl">10.25437</span>, <span class="fl">9.876195</span>, <span class="fl">10.79338</span>, <span class="fl">10.60699</span>, <span class="fl">10.48396</span>, <span class="fl">13.33961</span>, <span class="fl">9.462969</span>, <span class="fl">10.14556</span>, </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>       <span class="fl">11.66342</span>, <span class="fl">11.55484</span>, <span class="fl">11.26203</span>, <span class="fl">12.31473</span>, <span class="fl">9.220009</span>, <span class="fl">11.25206</span>, <span class="fl">10.48662</span>, <span class="fl">9.025091</span>, <span class="fl">9.693386</span>, </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>       <span class="fl">11.45989</span>, <span class="fl">12.44213</span>, <span class="fl">11.18981</span>, <span class="fl">11.56674</span>, <span class="fl">9.869849</span>, <span class="fl">12.11311</span>, <span class="fl">11.48656</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fu">seq_along</span>(x)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">i=</span>i, <span class="at">x=</span>x)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="dv">10</span>       <span class="co"># 均值</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="dv">2</span>  <span class="co"># 标准差</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">5</span>        <span class="co"># 子组样本量</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>UCL <span class="ot">&lt;-</span> mu <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> sigma <span class="sc">/</span> <span class="fu">sqrt</span>(n)  <span class="co"># 上控制限</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>LCL <span class="ot">&lt;-</span> mu <span class="sc">-</span> <span class="dv">3</span> <span class="sc">*</span> sigma <span class="sc">/</span> <span class="fu">sqrt</span>(n)  <span class="co"># 下控制限</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> i, <span class="at">y =</span> x)) <span class="sc">+</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">4</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span>  <span class="co"># 绘制均值点</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> UCL, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># 上控制限</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> LCL, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># 下控制限</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">11</span>, <span class="at">y =</span> UCL, <span class="at">label =</span> <span class="st">"UCL"</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span>  <span class="co"># 标注UCL</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">11</span>, <span class="at">y =</span> LCL, <span class="at">label =</span> <span class="st">"LCL"</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">1.5</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span>  <span class="co"># 标注LCL</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">25</span>),</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">25</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()  <span class="co"># 使用简洁主题</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-13_3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-13_3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="13_files/figure-html/fig-13_3-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-13_3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;13.3: <span class="math inline">\(\overline{X}\)</span>-控制图
</figcaption>
</figure>
</div>
</div>
</div>
<p>均值变化大小与合适的移动平均跨度大小 <span class="math inline">\(k\)</span> 之间往往存在负相关性。也就是说，均值变化越小，<span class="math inline">\(k\)</span> 的取值应该越大。<span class="math inline">\(\blacksquare\)</span></p>
</div>
</section>
<section id="13_6_2" class="level3" data-number="13.6.2">
<h3 data-number="13.6.2" class="anchored" data-anchor-id="13_6_2"><span class="header-section-number">13.6.2</span> 指数加权移动平均控制图</h3>
<p><a href="#sec-13_6_1" class="quarto-xref"><span>小节 13.6.1</span></a> 中的 <strong>移动平均控制图</strong> 在每个 <span class="math inline">\(t\)</span> 时刻都考虑了到该时刻为止的所有子组平均值的加权平均值，其中最近的 <span class="math inline">\(k\)</span> 个子组的权重为 <span class="math inline">\(1/k\)</span> ，其他子组的权重为 0。这似乎是检测总体均值微小变化的最有效的方式，所以也引发了对其他可能性的思考——采用其他的权重来计算加权平均值。</p>
<p>令</p>
<p><span id="eq-13_6_1"><span class="math display">\[
W_t=\alpha\overline{X}_t+(1 - \alpha)W_{t - 1}
\tag{13.9}\]</span></span></p>
<p>其中 <span class="math inline">\(\alpha\)</span> 是介于 0 和 1 之间的常数，并且</p>
<p><span class="math inline">\(W_0=\mu\)</span></p>
<p>我们称 <span class="math inline">\(W_t, t = 0,1,2,\cdots\)</span> 为 <strong>指数加权移动平均值</strong>。为了理解为什么要如此称呼这个序列，我们需要注意到：如果不断地用@eq-13_6_1 替换该式右侧的 <span class="math inline">\(W\)</span>，我们会得到：</p>
<p><span id="eq-13_6_2"><span class="math display">\[
\begin{align*}
W_t&amp;=\alpha\overline{X}_t+(1 - \alpha)[\alpha\overline{X}_{t - 1}+(1 - \alpha)W_{t - 2}] \\
&amp;=\alpha\overline{X}_t+\alpha(1 - \alpha)\overline{X}_{t - 1}+(1 - \alpha)^2W_{t - 2}\\
&amp;=\alpha\overline{X}_t+\alpha(1 - \alpha)\overline{X}_{t - 1}+(1 - \alpha)^2[\alpha\overline{X}_{t - 2}+(1 - \alpha)W_{t - 3}]\\
&amp;=\alpha\overline{X}_t+\alpha(1 - \alpha)\overline{X}_{t - 1}+\alpha(1 - \alpha)^2\overline{X}_{t - 2}+(1 - \alpha)^3W_{t - 3}\\
&amp;\vdots\\
&amp;=\alpha\overline{X}_t+\alpha(1 - \alpha)\overline{X}_{t - 1}+\alpha(1 - \alpha)^2\overline{X}_{t - 2}+\cdots\\
&amp;+\alpha(1 - \alpha)^{t - 1}\overline{X}_1+(1 - \alpha)^t\mu
\end{align*}
\tag{13.10}\]</span></span></p>
<p>因此，从 <a href="#eq-13_6_2" class="quarto-xref">式&nbsp;<span>13.10</span></a> 中，我们可以看出，<span class="math inline">\(W_t\)</span> 是到 <span class="math inline">\(t\)</span> 时刻为止所有子组平均值的加权平均值，最近的子组的权重为 <span class="math inline">\(\alpha\)</span>，然后对于之后的子组不停的乘以 <span class="math inline">\(1 - \alpha\)</span> 以持续降低其对应子组的权重，最后受控总体均值的权重为 <span class="math inline">\((1 - \alpha)^t\)</span>。</p>
<p><span class="math inline">\(\alpha\)</span> 的值越小，后续子组的权重就越均匀。例如，如果 <span class="math inline">\(\alpha = 0.1\)</span>，那么初始权重是 0.1，后续权重以 0.9 为因子不断减小；也就是说，权重依次是 <span class="math inline">\(0.1, 0.09, 0.081, 0.073, 0.066, 0.059, \cdots\)</span>。另一方面，如果 <span class="math inline">\(\alpha = 0.4\)</span>，那么权重将依次是 <span class="math inline">\(0.4, 0.24, 0.144, 0.087, 0.052, \cdots\)</span>。</p>
<p>由于权重 <span class="math inline">\(\alpha(1 - \alpha)^{i - 1}, i = 1, 2, \cdots\)</span> ，可以写成</p>
<p><span class="math inline">\(\alpha(1 - \alpha)^{i - 1}=\overline{\alpha}e^{-\beta i}\)</span></p>
<p>其中，<span class="math inline">\(\overline{\alpha}=\frac{\alpha}{1 - \alpha}, \quad \beta = -\log(1 - \alpha)\)</span></p>
<p>所以，我们说数据是通过连续的“指数加权” 所得到的。（见 <a href="#fig-13_4" class="quarto-xref">图&nbsp;<span>13.4</span></a>）。</p>
<div class="cell">
<details class="code-fold">
<summary>代码</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 设置alpha值</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.4</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 生成i的序列，这里从1到10</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="fl">0.1</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算权重</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> alpha <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> alpha)<span class="sc">^</span>(i <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制图形</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(i, weights, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"i"</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="fu">expression</span>(alpha <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> alpha)<span class="sc">^</span>(i <span class="sc">-</span> <span class="dv">1</span>)))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-13_4" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-13_4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="13_files/figure-html/fig-13_4-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-13_4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;13.4: 当<span class="math inline">\(\alpha=0.4\)</span>时<span class="math inline">\(\alpha(1-\alpha)^{i-1}\)</span>的函数图
</figcaption>
</figure>
</div>
</div>
</div>
<p>为了计算 <span class="math inline">\(W_t\)</span> 的均值和方差，我们需要回想一下：当 <strong>过程</strong> 处于受控状态时，子组平均值 <span class="math inline">\(\overline{X}_i\)</span> 是相互独立的正态随机变量，并且每个子组的平均值的均值为 <span class="math inline">\(\mu\)</span>、方差为 <span class="math inline">\(\sigma^{2}/n\)</span>。因此，使用 <a href="#eq-13_6_2" class="quarto-xref">式&nbsp;<span>13.10</span></a>，有：</p>
<p><span class="math display">\[
\begin{align*}
E[W_t]&amp;=\mu[\alpha+\alpha(1 - \alpha)+\alpha(1 - \alpha)^2+\cdots+\alpha(1 - \alpha)^{t - 1}+(1 - \alpha)^t]\\
&amp;=\frac{\mu\alpha[1-(1 - \alpha)^t]}{1-(1 - \alpha)}+\mu(1 - \alpha)^t\\
&amp;=\mu
\end{align*}
\]</span></p>
<p>再次使用 <a href="#eq-13_6_2" class="quarto-xref">式&nbsp;<span>13.10</span></a> 以确定方差：</p>
<p><span class="math display">\[
\begin{align*}
\text{Var}(W_t)&amp;=\frac{\sigma^{2}}{n}\left\{\alpha^{2}+[\alpha(1 - \alpha)]^{2}+[\alpha(1 - \alpha)^2]^{2}+\cdots+[\alpha(1 - \alpha)^{t - 1}]^{2}\right\}\\
&amp;=\frac{\sigma^{2}}{n}\alpha^{2}[1+\beta+\beta^{2}+\cdots+\beta^{t - 1}] \quad \text{其中 } \beta=(1 - \alpha)^2\\
&amp;=\frac{\sigma^{2}\alpha^{2}[1-(1 - \alpha)^{2t}]}{n[1-(1 - \alpha)^2]}\\
&amp;=\frac{\sigma^{2}\alpha[1-(1 - \alpha)^{2t}]}{n(2 - \alpha)}
\end{align*}
\]</span></p>
<p>因此，当 <span class="math inline">\(t\)</span> 很大时，只要 <strong>过程</strong> 始终保持在受控状态：</p>
<p><span class="math display">\[
\begin{align*}
E[W_t]&amp;=\mu\\
\text{Var}(W_t)&amp;\approx\frac{\sigma^{2}\alpha}{n(2 - \alpha)} \quad \text{因为 } (1 - \alpha)^{2t}\approx0
\end{align*}
\]</span></p>
<p>因此，<span class="math inline">\(W_t\)</span> 的上、下控制限由以下公式给出：</p>
<p><span class="math display">\[
\begin{align*}
\text{UCL}&amp;=\mu + 3\sigma\sqrt{\frac{\alpha}{n(2 - \alpha)}}\\
\text{LCL}&amp;=\mu - 3\sigma\sqrt{\frac{\alpha}{n(2 - \alpha)}}
\end{align*}
\]</span></p>
<p>注意，当指数加权移动平均控制图的控制限与跨度为 <span class="math inline">\(k\)</span> 的移动平均控制图（在初始的 <span class="math inline">\(k\)</span> 个值之后）中的控制限相同时：</p>
<p><span class="math display">\[
\frac{3\sigma}{\sqrt{nk}}=3\sigma\sqrt{\frac{\alpha}{n(2 - \alpha)}}
\]</span></p>
<p>即，</p>
<p><span class="math display">\[
k=\frac{2 - \alpha}{\alpha} \quad \text{或} \quad \alpha=\frac{2}{k + 1}
\]</span></p>
<div id="exr-13_6_b" class="theorem exercise">
<p><span class="theorem-title"><strong>习题 13.4</strong></span> 一家维修店会派一名工人前往预约者家中维修电子设备。收到维修电话后，维修店会派遣一名工人，该工人在完成维修工作后需要电话汇报维修情况。历史数据表明，从派遣维修人员到其电话汇报之间的时间服从正态分布，其均值为 62 分钟，标准差为 24 分钟。为了关注从派遣维修人员到其电话汇报之间的时间的任何变化，该维修店绘制了一张标准的指数加权移动平均（<em>EWMA</em>）控制图，图中每个数据点是连续 4 次维修时间的平均值，且加权因子 <span class="math inline">\(\alpha = 0.25\)</span>。如果该控制图的当前值为 60，并且以下是接下来的 16 个子组平均值，我们能得出什么结论？</p>
<p>48, 52, 70, 62, 57, 81, 56, 59, 77, 82, 78, 80, 74, 82, 68, 84</p>
</div>
<div id="sol-13_6_b" class="proof solution">
<p><span class="proof-title"><em>解 13.4</em>. </span>从 <span class="math inline">\(W_0 = 60\)</span> 开始，可以根据公式：</p>
<p><span class="math inline">\(W_t = 0.25\overline{X}_t + 0.75W_{t - 1}\)</span></p>
<p>计算得到 <span class="math inline">\(W_1,\cdots,W_{16}\)</span> 的连续值。</p>
<p>计算结果如下：</p>
<p><span class="math display">\[
\begin{align*}
W_1&amp;=(0.25)(48)+(0.75)(60)=57\\
W_2&amp;=(0.25)(52)+(0.75)(57)=55.75\\
W_3&amp;=(0.25)(70)+(0.75)(55.75)=59.31\\
W_4&amp;=(0.25)(62)+(0.75)(59.31)=59.98\\
W_5&amp;=(0.25)(57)+(0.75)(59.98)=59.24\\
W_6&amp;=(0.25)(81)+(0.75)(59.24)=64.68
\end{align*}
\]</span></p>
<p>以此类推，<span class="math inline">\(W_7\)</span> 到 <span class="math inline">\(W_{16}\)</span> 的值如下：</p>
<p><span class="math inline">\(62.50, 61.61, 65.48, 69.60, 71.70, 73.78, 73.83, 75.87, 73.90, 76.43\)</span></p>
<p>因为 <span class="math inline">\(3\sqrt{\frac{0.25}{1.75}}\frac{24}{\sqrt{4}} = 13.61\)</span>，因此在加权因子 <span class="math inline">\(\alpha = 0.25\)</span> 时的指数加权移动平均（<em>EWMA</em>）控制图的控制限为：</p>
<p><span class="math display">\[
\begin{align*}
\text{LCL}&amp;=62 - 13.61 = 48.39\\
\text{UCL}&amp;=62 + 13.61 = 75.61
\end{align*}
\]</span></p>
<p>因此，根据 EWMA 控制图，我们会判断在 <span class="math inline">\(W_{14}\)</span>（以及 <span class="math inline">\(W_{16}\)</span>）之后，系统将处于失控状态。另一方面，有趣的是，子组标准差为 <span class="math inline">\(\sigma/\sqrt{n}=12\)</span>，但是没有任何一个数据与 <span class="math inline">\(\mu = 62\)</span> 之间的差距超过了 2 个标准差，所以标准的 <span class="math inline">\(\overline{X}\)</span>-控制图并不会判定系统失控。<span class="math inline">\(\blacksquare\)</span></p>
</div>
<div id="exm-13_6_c" class="theorem example">
<p><span class="theorem-title"><strong>例 13.4</strong></span> 对于 <a href="#exm-13_6_a" class="quarto-xref">例&nbsp;<span>13.3</span></a> 中的数据，如果使用 <span class="math inline">\(\alpha=\frac{2}{9}\)</span> 的 EWMA 控制图，我们得到如下的数据(*表示失控)。</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><span class="math inline">\(t\)</span></th>
<th><span class="math inline">\(\overline{X}_t\)</span></th>
<th><span class="math inline">\(W_t\)</span></th>
<th><span class="math inline">\(t\)</span></th>
<th><span class="math inline">\(\overline{X}_t\)</span></th>
<th><span class="math inline">\(W_t\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>9.617728</td>
<td>9.915051</td>
<td>14</td>
<td>9.220009</td>
<td>10.84522</td>
</tr>
<tr class="even">
<td>2</td>
<td>10.25437</td>
<td>9.990456</td>
<td>15</td>
<td>11.25206</td>
<td>10.93563</td>
</tr>
<tr class="odd">
<td>3</td>
<td>9.867195</td>
<td>9.963064</td>
<td>16</td>
<td>10.48662</td>
<td>10.83585</td>
</tr>
<tr class="even">
<td>4</td>
<td>10.79338</td>
<td>10.14758</td>
<td>17</td>
<td>9.025091</td>
<td>10.43346</td>
</tr>
<tr class="odd">
<td>5</td>
<td>10.60699</td>
<td>10.24967</td>
<td>18</td>
<td>9.693386</td>
<td>10.269</td>
</tr>
<tr class="even">
<td>6</td>
<td>10.48396</td>
<td>10.30174</td>
<td>19</td>
<td>11.45989</td>
<td>10.53364</td>
</tr>
<tr class="odd">
<td>*7</td>
<td>13.33961</td>
<td>10.97682</td>
<td>*20</td>
<td>12.44213</td>
<td>10.95775</td>
</tr>
<tr class="even">
<td>8</td>
<td>9.462969</td>
<td>10.64041</td>
<td>*21</td>
<td>11.18981</td>
<td>11.00932</td>
</tr>
<tr class="odd">
<td>9</td>
<td>10.14556</td>
<td>10.53044</td>
<td>*22</td>
<td>11.56674</td>
<td>11.13319</td>
</tr>
<tr class="even">
<td>10</td>
<td>11.66342</td>
<td>10.78221</td>
<td>23</td>
<td>9.869849</td>
<td>10.85245</td>
</tr>
<tr class="odd">
<td>*11</td>
<td>11.55484</td>
<td>10.95391</td>
<td>*24</td>
<td>12.11311</td>
<td>11.13259</td>
</tr>
<tr class="even">
<td>*12</td>
<td>11.26203</td>
<td>11.02238</td>
<td>*25</td>
<td>11.48656</td>
<td>11.21125</td>
</tr>
<tr class="odd">
<td>*13</td>
<td>12.31473</td>
<td>11.30957</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div class="cell">
<details class="code-fold">
<summary>代码</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">9.915051</span>, <span class="fl">9.990456</span>, <span class="fl">9.963064</span>, <span class="fl">10.14758</span>, <span class="fl">10.24967</span>, <span class="fl">10.30174</span>, <span class="fl">10.97682</span>, <span class="fl">10.64041</span>, <span class="fl">10.53044</span>, </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>       <span class="fl">10.78221</span>, <span class="fl">10.95391</span>, <span class="fl">11.02238</span>, <span class="fl">11.30957</span>, <span class="fl">10.84522</span>, <span class="fl">10.93563</span>, <span class="fl">10.83585</span>, <span class="fl">10.43346</span>, <span class="fl">10.269</span>, </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>       <span class="fl">10.53364</span>, <span class="fl">10.95775</span>, <span class="fl">11.00932</span>, <span class="fl">11.13319</span>, <span class="fl">10.85245</span>, <span class="fl">11.13259</span>, <span class="fl">11.21125</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fu">seq_along</span>(x)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">i=</span>i, <span class="at">x=</span>x)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>UCL <span class="ot">&lt;-</span> <span class="fl">10.94868</span>  <span class="co"># 上控制限</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>LCL <span class="ot">&lt;-</span> <span class="fl">9.051318</span>  <span class="co"># 下控制限</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> i, <span class="at">y =</span> x)) <span class="sc">+</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">4</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span>  <span class="co"># 绘制均值点</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> UCL, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># 上控制限</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> LCL, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># 下控制限</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">11</span>, <span class="at">y =</span> UCL, <span class="at">label =</span> <span class="st">"UCL"</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span>  <span class="co"># 标注UCL</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">11</span>, <span class="at">y =</span> LCL, <span class="at">label =</span> <span class="st">"LCL"</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">1.5</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span>  <span class="co"># 标注LCL</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">25</span>),</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">25</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()  <span class="co"># 使用简洁主题</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-13_5" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-13_5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="13_files/figure-html/fig-13_5-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-13_5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;13.5: 移动平均控制图
</figcaption>
</figure>
</div>
</div>
</div>
<p>因为 <span class="math inline">\(\text{UCL} = 10.94868, \text{LCL}=9.051318\)</span>，因此，根据 <a href="#fig-13_5" class="quarto-xref">图&nbsp;<span>13.5</span></a>，当 <span class="math inline">\(t=7\)</span> 时，<strong>过程</strong> 就开始处于失控状态。<span class="math inline">\(\blacksquare\)</span></p>
</div>
</section>
<section id="sec-13_6_3" class="level3" data-number="13.6.3">
<h3 data-number="13.6.3" class="anchored" data-anchor-id="sec-13_6_3"><span class="header-section-number">13.6.3</span> 累计和控制图</h3>
<p>在检测较小的均值变化或者中等规模的均值变化方面，累计和（通常简称为 cu-sum）控制图也是一种较为有效的检测方法。</p>
<p>假设 <span class="math inline">\(\overline{X}_1, \overline{X}_2, \cdots\)</span> 表示大小为 <span class="math inline">\(n\)</span> 的子组的连续平均值，并且当 <strong>过程</strong> 处于受控状态时，这些随机变量的均值为 <span class="math inline">\(\mu\)</span>，标准差为 <span class="math inline">\(\sigma/\sqrt{n}\)</span>。最初，假设我们只对检测均值何时增加感兴趣。（单边）累计和控制图可用于检测均值增加的场景，其运作方式如下：</p>
<p>选择大于 0 的常数 <span class="math inline">\(d\)</span> 和 <span class="math inline">\(B\)</span> ，并令</p>
<p><span class="math inline">\(Y_j = \overline{X}_j - \mu - d\sigma/\sqrt{n}, \quad j\geq1\)</span></p>
<p>注意，当 <strong>过程</strong> 处于受控状态时，<span class="math inline">\(E[\overline{X}_j] = \mu\)</span> ，所以</p>
<p><span class="math inline">\(E[Y_j] = -d\sigma/\sqrt{n} &lt; 0\)</span></p>
<p>现在，令</p>
<p><span class="math inline">\(\begin{align*} S_0 &amp;= 0\\ S_{j + 1} &amp;= \max\{S_j + Y_{j + 1}, 0\}, \quad j\geq0 \end{align*}\)</span></p>
<p>参数为 <span class="math inline">\(d\)</span> 和 <span class="math inline">\(B\)</span> 的累计和控制图会持续绘制 <span class="math inline">\(S_j\)</span>，并在满足 <span class="math inline">\(S_j &gt; B\sigma/\sqrt{n}\)</span> 的第一个 <span class="math inline">\(j\)</span> 时判断均值已经增加。</p>
<p>为了理解这个控制图背后的原理，假设我们决定持续绘制到目前为止观察到的所有随机变量 <span class="math inline">\(Y_i\)</span> 的总和。也就是说，假设我们决定绘制 <span class="math inline">\(P_j\)</span> 序列，其中</p>
<p><span class="math inline">\(P_j = \sum_{i = 1}^{j}Y_i\)</span> 或者 <span class="math inline">\(\begin{align*} P_0 &amp;= 0\\ P_{j + 1} &amp;= P_j + Y_{j + 1}, \quad j\geq0 \end{align*}\)</span></p>
<p>当系统一直处于受控状态时，所有的 <span class="math inline">\(Y_i\)</span> 的期望值均为负数，因此我们会期望 <span class="math inline">\(P_j\)</span> 为负数。因此，如果 <span class="math inline">\(P_j\)</span> 的值变得很大——比如说，大于 <span class="math inline">\(B\sigma/\sqrt{n}\)</span>——那么这将是 <strong>过程</strong> 失控的有力证据。然而，问题在于，如果系统在很长时间后才失控，那么那时 <span class="math inline">\(P_j\)</span> 的值很可能是非常小的负数（因为在失控之前我们一直在对均值为负数的随机变量求和），因此需要经过很长的时间才能令 <span class="math inline">\(P_j\)</span> 的值超过 <span class="math inline">\(B\sigma/\sqrt{n}\)</span>。因此，为了在 <strong>过程</strong> 处于受控状态时避免 <span class="math inline">\(P_j\)</span> 变成非常小的负数，累计和控制图采用了一个简单的技巧：每当 <span class="math inline">\(P_j\)</span> 变为负数时就将其重置为 0。也就是说，<span class="math inline">\(S_j\)</span> 是直到时间 <span class="math inline">\(j\)</span> 为止所有 <span class="math inline">\(Y_i\)</span> 的累计和（但是，每当所有 <span class="math inline">\(Y_i\)</span> 的累计总和小于 0 时，<span class="math inline">\(S_j\)</span> 将被重置为 0）。</p>
<div id="exm-13_6_d" class="theorem example">
<p><span class="theorem-title"><strong>例 13.5</strong></span> 假设子组平均值的均值、标准差分别为 <span class="math inline">\(\mu = 30\)</span>、<span class="math inline">\(\sigma/\sqrt{n}=8\)</span>，考虑绘制参数 <span class="math inline">\(d = 0.5\)</span>，<span class="math inline">\(B = 5\)</span> 的累计和控制图。如果前八个子组的平均值为 29, 33, 35, 42, 36, 44, 43, 45，</p>
<p>那么 <span class="math inline">\(Y_j=\overline{X}_j - 30 - 4=\overline{X}_j - 34\)</span> 为：</p>
<p><span class="math inline">\(Y_1=-5\)</span>，<span class="math inline">\(Y_2=-1\)</span>，<span class="math inline">\(Y_3 = 1\)</span>，<span class="math inline">\(Y_4 = 8\)</span>，<span class="math inline">\(Y_5 = 2\)</span>，<span class="math inline">\(Y_6 = 10\)</span>，<span class="math inline">\(Y_7 = 9\)</span>，<span class="math inline">\(Y_8 = 11\)</span></p>
<p>因此，</p>
<p><span class="math display">\[
\begin{align*}
S_1&amp;=\max\{-5, 0\}=0\\
S_2&amp;=\max\{-1, 0\}=0\\
S_3&amp;=\max\{1, 0\}=1\\
S_4&amp;=\max\{9, 0\}=9\\
S_5&amp;=\max\{11, 0\}=11\\
S_6&amp;=\max\{21, 0\}=21\\
S_7&amp;=\max\{30, 0\}=30\\
S_8&amp;=\max\{41, 0\}=41
\end{align*}
\]</span></p>
<p>由于控制限为 <span class="math inline">\(B\sigma/\sqrt{n}=5\times(8)=40\)</span>，因此根据累计和控制图，在观察到第八个子组的平均值后会，我们将判断均值已经增加。<span class="math inline">\(\blacksquare\)</span></p>
</div>
<p>为了检测均值的正向或负向变化，我们可以同时使用两个单边累计和控制图。首先，<span class="math inline">\(E[X_i]\)</span> 的减小等价于 <span class="math inline">\(E[-X_i]\)</span> 的增加，因此，我们可以通过对子组平均值的负值运行单边累计和控制图来检测产品均值的减小。也就是说，对于指定的参数 <span class="math inline">\(d\)</span> 和 <span class="math inline">\(B\)</span>，我们不仅要像之前那样绘制量 <span class="math inline">\(S_j\)</span>，而且还令</p>
<p><span class="math inline">\(W_j = -\overline{X}_j - (-\mu) - d\sigma/\sqrt{n}=\mu - \overline{X}_j - d\sigma/\sqrt{n}\)</span></p>
<p>并且，<span class="math inline">\(\begin{align*} T_0&amp;=0\\ T_{j + 1}&amp;=\max\{T_j + W_{j + 1}, 0\}, \quad j\geq0 \end{align*}\)</span></p>
<p>然后也绘制 <span class="math inline">\(T_j\)</span> 的值。</p>
<p>当 <span class="math inline">\(S_j\)</span> 或 <span class="math inline">\(T_j\)</span> 首次超过 <span class="math inline">\(B\sigma/\sqrt{n}\)</span> 时，就判定 <strong>过程</strong> 失控。</p>
<p>总之，用于检测所生产产品的均值变化的累计和控制图的步骤如下：</p>
<ol type="1">
<li>选择大于 0 的常数 <span class="math inline">\(d\)</span> 和 <span class="math inline">\(B\)</span></li>
<li>使用连续的子组平均值来确定 <span class="math inline">\(S_j\)</span> 和 <span class="math inline">\(T_j\)</span></li>
<li>当 <span class="math inline">\(S_j\)</span> 或 <span class="math inline">\(T_j\)</span> 首次超过 <span class="math inline">\(B\sigma/\sqrt{n}\)</span> 时，则判定 <strong>过程</strong> 失控</li>
</ol>
<p><span class="math inline">\(d\)</span> 和 <span class="math inline">\(B\)</span> 的取值一般有 3 种：</p>
<ol type="1">
<li><span class="math inline">\(d = 0.25\)</span>，<span class="math inline">\(B = 8.00\)</span></li>
<li><span class="math inline">\(d = 0.50\)</span>，<span class="math inline">\(B = 4.77\)</span></li>
<li><span class="math inline">\(d = 1\)</span> ，<span class="math inline">\(B = 2.49\)</span></li>
</ol>
<p>如上的任何一种选择所产生的控制规则的误报率都与在子组平均值与 <span class="math inline">\(\mu\)</span> 的差值首次超过 <span class="math inline">\(3\sigma/\sqrt{n}\)</span> 时就判定 <strong>过程</strong> 失控的 <span class="math inline">\(\overline{X}\)</span>-控制图大致相同。作为一个通用的经验法则，当想要防范的均值变化越小时，所选的 <span class="math inline">\(d\)</span> 值就应该越小。</p>
</section>
</section>
<section id="problems" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="problems">Problems</h2>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "已复制");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "已复制");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/wangwei1237\.github\.io\/introduction_to_probability_and_statistics\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="wangwei1237/introduction_to_probability_and_statistics" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapter_12/12.html" class="pagination-link" aria-label="非参数假设检验">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">非参数假设检验</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapter_14/14.html" class="pagination-link" aria-label="Life testing">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Life testing</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright Wang Wei. All Rights Reserved.</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/wangwei1237/introduction_to_probability_and_statistics/edit/main/chapter_13/13.qmd" class="toc-action"><i class="bi bi-github"></i>编辑该页面</a></li><li><a href="https://github.com/wangwei1237/introduction_to_probability_and_statistics/issues/new" class="toc-action"><i class="bi empty"></i>反馈问题</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>